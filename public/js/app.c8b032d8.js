(function(t){function e(e){for(var i,r,o=e[0],l=e[1],u=e[2],d=0,_=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&_.push(n[r][0]),n[r]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);c&&c(e);while(_.length)_.shift()();return s.push.apply(s,u||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],i=!0,o=1;o<a.length;o++){var l=a[o];0!==n[l]&&(i=!1)}i&&(s.splice(e--,1),t=r(r.s=a[0]))}return t}var i={},n={app:0},s=[];function r(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=i,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(a,i,function(e){return t[e]}.bind(null,i));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var c=l;s.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"3dfd":function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("div",[e("b-navbar",{staticClass:"nav-weskari",attrs:{toggleable:"lg",type:"dark"}},[e("img",{staticClass:"mr-3",attrs:{src:a("e347"),height:"40px"}}),e("b-navbar-brand",{staticClass:"brand",attrs:{to:{path:"/"}}},[t._v("WESKARI ")]),e("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),e("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[e("b-navbar-nav",[e("b-nav-item",{attrs:{to:"/lainat"}},[t._v("Lainat")]),e("b-nav-item",{attrs:{to:"/asiakkaat"}},[t._v("Asiakkaat")]),e("b-nav-item",{attrs:{to:"/kirjastot"}},[t._v("Kirjastot")]),e("b-nav-item",{attrs:{to:"/organisaatiot"}},[t._v("Organisaatiot")]),e("b-nav-item",{attrs:{to:"/saatteet"}},[t._v("Saatteet")]),e("b-nav-item",{attrs:{to:"/tilastot"}},[t._v("Tilastot")])],1),e("b-navbar-nav",{staticClass:"ml-auto"},[e("b-nav-item-dropdown",{attrs:{right:""},scopedSlots:t._u([{key:"button-content",fn:function(){return[e("em",[t._v(t._s(t.$G.user))])]},proxy:!0}])},[e("b-dropdown-item",{attrs:{href:"/Shibboleth.sso/Logout"}},[t._v("kirjaudu ulos")])],1)],1)],1)],1)],1),t.$G.login?e("b-container",{attrs:{fluid:""}},[e("keep-alive",{attrs:{include:"WELoans,WELibrary,WEClient"}},[t.error?t._e():e("router-view",{staticClass:"view"})],1),t.error?e("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e()],1):t._e()],1)},n=[],s=(a("d3b7"),{name:"app",data:function(){return{error:null,user:null,logging:!1,intervalID:null}},methods:{login:function(){var t=this;console.log("trying login..."),fetch(this.$G.api_url+"/api/auth",{credentials:"include"}).then((function(t){if(!t.ok)throw{msg:"session terminated"};return t})).then((function(t){return t.json()})).then((function(e){t.$G.user=e.shibboleth.user})).catch((function(e){console.log(e),e.msg&&"session terminated"==e.msg?t.error="Kirjautuminen vanheni. Lataa sivu uudestaan.":t.error="Kirjautuminen epäonnistui. Kirjautuminen luultavasti vanheni, lataa sivu uudestaan.",t.$G.user=""}))}},watch:{$route:{immediate:!0,handler:function(t,e){document.title=t.meta.title||"WESKARI"}}},created:function(){var t=this;document.title="WESKARI",console.log(window.location.hostname),"localhost"==window.location.hostname&&(this.$G.api_url=""),this.login(),this.intervalID=setInterval((function(){return t.login()}),3e4)},beforeDestroy:function(){clearInterval(this.intervalID)}}),r=s,o=(a("75d6"),a("2877")),l=Object(o["a"])(r,i,n,!1,null,null,null);e["a"]=l.exports},5370:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return t.item.tilaus_saatu?e("div",{staticStyle:{"min-width":"250px"}},[t.$G.isOverdue(t.item.tilaus_saatu.pvm_erapaiva)?e("div",{staticClass:"text-danger"},[e("b",[t._v(t._s(t.$G.formatDate(t.item.tilaus_saatu.pvm_erapaiva,"reverse",".")))])]):e("div",{staticClass:"text-info"},[t._v(t._s(t.$G.formatDate(t.item.tilaus_saatu.pvm_erapaiva,"reverse",".")))]),"no"==t.item.tilaus_saatu.uusittavissa?e("span",{staticClass:"text-danger",staticStyle:{"margin-left":"10px",padding:"0px"}},[t._v("ei voi uusia")]):t._e(),t.item.tilaus_saatu.info&&"undefined"!=t.item.tilaus_saatu.info?e("div",[t._v(t._s(t.item.tilaus_saatu.info))]):t._e()]):e("div",[t._v("-")])},n=[],s={name:"WEDueDateDisplay",props:["item"]},r=s,o=a("2877"),l=Object(o["a"])(r,i,n,!1,null,null,null);e["a"]=l.exports},"56d7":function(t,e,a){"use strict";a.r(e),function(t){a("e260"),a("e6cf"),a("cca6"),a("a79d"),a("14d9"),a("4d90"),a("d3b7"),a("25f0"),a("a15b"),a("fb6a"),a("ac1f"),a("1276");var e=a("2b0e"),i=a("8c4f"),n=a("5f5b"),s=a("b1e0"),r=a("ae77"),o=a("df45"),l=a("bb25"),u=a("f392"),c=a("ccd2"),d=a("a15b6"),_=a("b4ac"),h=a("9e54"),p=(a("f9e3"),a("2dd8"),a("3dfd"));e["default"].use(n["a"]),e["default"].use(s["a"]),e["default"].use(i["a"]);var k=new i["a"]({base:t,routes:[{path:"/",component:r["a"]},{path:"/pyynnot/:id",component:o["a"]},{path:"/organisaatiot",component:l["a"]},{path:"/organisaatiot/:id",component:l["a"]},{path:"/asiakkaat",component:u["a"]},{path:"/asiakkaat/:id",component:u["a"]},{path:"/kirjastot",component:c["a"]},{path:"/kirjastot/:id",component:c["a"]},{path:"/saatteet",component:d["a"]},{path:"/saatteet/:id",component:d["a"]},{path:"/lainat",component:_["a"]},{path:"/tilastot",component:h["a"]}]});e["default"].config.productionTip=!1;var m=new e["default"]({data:{api_url:"/api",login:!0,error:null,user:null},methods:{getStatus:function(t){return"kasittelyssa"==t?"käsittelyssä":t},isOverdue:function(t){var e=new Date(t),a=new Date;return e.getTime()<a.getTime()},formatDate:function(t,e,a){a||(a=".");var i=[];if(t){var n=new Date(t);return n instanceof Date&&isFinite(n)?(i.push(n.getFullYear()),i.push((n.getMonth()+1).toString().padStart(2,"0")),i.push(n.getDate().toString().padStart(2,"0")),e?i.reverse().join(a):i.join(a)):t}return"-"},getDateFromUUID:function(t){var e=new Date(1e3*parseInt(t.substring(0,8),16)),a=new Intl.DateTimeFormat("fi-FI").format(e);return a},getToday:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".",i=new Date;return e&&i.setMonth(i.getMonth()+e),t?("0"+i.getDate()).slice(-2)+a+("0"+(i.getMonth()+1)).slice(-2)+a+i.getFullYear():i.getFullYear()+a+("0"+(i.getMonth()+1)).slice(-2)+a+("0"+i.getDate()).slice(-2)},renderBreaks:function(t,e){return t&&"string"===typeof t?t.split(e).join("<br>"):""},getInfo:function(t,e){var a={pyynto_id:{en:"ID",fi:"ID"},teoksen_tiedot:{en:"title",fi:"teos"},sivut:{en:"pages",fi:"sivut"},julkaisun_tiedot:{en:"publication",fi:"julkaisu"}};return a["teoksen_tiedot"][e]+": "+t.teoksen_tiedot}},computed:{local:function(){return"localhost"==window.location.hostname?"":this.api_url}}});m.install=function(){Object.defineProperty(e["default"].prototype,"$G",{get:function(){return m}})},e["default"].use(m),new e["default"]({router:k,render:function(t){return t(p["a"])}}).$mount("#app")}.call(this,"/")},"5a66":function(t,e,a){"use strict";a("da62")},"6afd":function(t,e,a){},"75d6":function(t,e,a){"use strict";a("6afd")},"772b":function(t,e,a){"use strict";a("9f80")},"96dd":function(t,e,a){"use strict";var i=a("c7eb"),n=a("1da1"),s=a("bc3a"),r=a.n(s),o={},l="/api";function u(t,e){return t.response&&t.response.data&&t.response.data.error?t.response.data.error:e}o.updateRequest=function(){var t=Object(n["a"])(Object(i["a"])().mark((function t(e,a){var n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=l+"/api/pyynnot/"+e,r.a.put(n,a).catch((function(t){throw u(t,"Pyyntö epäonnistui")}));case 2:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),o.getLoanCount=Object(n["a"])(Object(i["a"])().mark((function t(){var e;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=l+"/api/pyynnot/loan_count",t.abrupt("return",r.a.get(e));case 2:case"end":return t.stop()}}),t)}))),e["a"]=o},"9e54":function(t,e,a){"use strict";a("ac1f"),a("841c");var i=function(){var t=this,e=t._self._c;return e("b-container",[e("h1",[t._v("Tilastot")]),e("div",{staticStyle:{"margin-top":"20px","margin-bottom":"20px"}},[e("b-link",{attrs:{href:"#"},on:{click:function(e){return t.search(t.year)}}},[t._v(t._s(t.year)+" ")]),t._v(" | "),e("b-link",{on:{click:function(e){return t.search(t.year-1)}}},[t._v(t._s(t.year-1)+" | ")]),e("b-link",{on:{click:function(e){return t.search(t.year-2)}}},[t._v(t._s(t.year-2))])],1),e("b-card",{attrs:{title:t.current_year}},[e("b-row",{staticClass:"my-1"},[e("b-col",{attrs:{sm:"12"}},[e("b-table",{attrs:{striped:"",items:t.stats,fields:t.fields}})],1)],1)],1)],1)},n=[],s=(a("d3b7"),{name:"WEStatistics",data:function(){return{year:0,current_year:0,stats:[],libs:{},fields:[{key:"count",label:"lainat"},{key:"kirjaston_nimi",label:"kirjasto"}]}},methods:{search:function(t){var e=this;this.current_year=t,this.error=null,fetch(this.$G.api_url+"/api/tilastot/"+t).then((function(t){if(!t.ok)throw t.status;return t.json()})).then((function(t){e.stats=t})).catch((function(t){console.log("error"+t),e.error="virhe: "+t}))}},mounted:function(){this.year=(new Date).getFullYear(),this.current_year=this.year,this.search((new Date).getFullYear())}}),r=s,o=a("2877"),l=Object(o["a"])(r,i,n,!1,null,null,null);e["a"]=l.exports},"9f80":function(t,e,a){},a15b6:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("b-container",{attrs:{fluid:""}},[e("h1",[t._v("Saatteet")]),t.ready&&0!==t.search_result.length&&!t.current&&""==t.mode?e("div",[e("b-table",{attrs:{items:t.search_result,fields:t.fields},scopedSlots:t._u([{key:"cell(_id)",fn:function(a){return[e("b-link",{attrs:{to:"/saatteet/"+a.item._id}},[t._v(t._s(a.value))])]}}],null,!1,1829266232)})],1):t._e(),t.ready&&t.current?e("b-card",{attrs:{title:t.current._id,"header-bg-variant":"dark"}},[e("div",{staticStyle:{"max-width":"700px"},domProps:{innerHTML:t._s(t.$G.renderBreaks(t.current.saate,"\n"))}}),e("br"),e("br"),"edit"!=t.mode?e("b-button",{on:{click:function(e){t.mode="edit"}}},[t._v("muokkaa")]):t._e()],1):t._e(),t.current&&"edit"==t.mode?e("b-card",{attrs:{title:t.current._id,"header-bg-variant":"dark"}},["edit"==t.mode?e("table",[e("tr",[e("td",{staticStyle:{"min-width":"200px"}},[t._v("saate")]),e("td",[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.current["saate"],expression:"current['saate']"}],attrs:{cols:"80",rows:"16"},domProps:{value:t.current["saate"]},on:{input:function(e){e.target.composing||t.$set(t.current,"saate",e.target.value)}}})])])]):t._e(),e("b-container",[e("b-button",{on:{click:function(e){return t.loadData()}}},[t._v("peru")]),e("b-button",{attrs:{variant:"info"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")])],1)],1):t._e(),e("div",{staticClass:"alert alert-info"},[t._v("Näillä placeholdereilla voit määrittää mihin mikin tieto tulee saatteessa. "),e("ul",[e("li",[t._v("[[ID]] = pyynnön tunniste")]),e("li",[t._v("[[FI]] = teoksen tiedot suomeksi ")]),e("li",[t._v("[[EN]] = teoksen tiedot englanniksi ")]),e("li",[t._v("[[ERAPAIVA]] = eräpäivä (saapumisilmoituksessa) ")]),e("li",[t._v("[[TARVITAAN_VIIMEISTAAN]] = tarvitaan viimeistään (tilauksessa) ")])])]),t.current?e("b-link",{attrs:{to:"/saatteet"}},[t._v("takaisin")]):t._e(),"add_new"==t.mode?e("b-card",{attrs:{title:"uusi saate","header-bg-variant":"dark"}},[e("table",t._l(t.fields,(function(a){return e("tr",{key:a.key},[e("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(a.key))]),e("td",[e("b-form-input",{model:{value:t.new_obj[a.key],callback:function(e){t.$set(t.new_obj,a.key,e)},expression:"new_obj[field.key]"}})],1)])})),0),e("b-button",{on:{click:function(e){t.mode=""}}},[t._v("peru")]),e("b-button",{attrs:{variant:"info"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")])],1):t._e()],1)},n=[],s=(a("d3b7"),a("e9c4"),a("14d9"),{name:"WEMessage",data:function(){return{search_result:[],current:null,ready:!1,mode:"",new_obj:{},fields:[{key:"_id"},{key:"saate"}]}},watch:{$route:function(t,e){this.$route.params.id||(this.current=null),this.loadData()}},methods:{saveForm:function(){var t=this;"add_new"==this.mode?fetch(this.$G.api_url+"/api/saatteet",{method:"POST",body:JSON.stringify(this.new_obj)}).then((function(t){return t.json()})).then((function(e){t.$router.push("/saatteet/"+e._id)})).catch((function(t){console.log("error"+t)})):"edit"==this.mode&&(console.log("edit"),delete this.current._id,console.log(this.current),fetch(this.$G.api_url+"/api/saatteet/"+this.$route.params.id,{method:"PUT",body:JSON.stringify(this.current)}).then((function(t){return t.json()})).then((function(e){t.loadData()})).catch((function(t){console.log("error"+t)})))},editForm:function(){console.log(this.edit),console.log("sdf"),this.edit=!this.edit},loadData:function(){var t=this;this.$route.params.id?(this.mode="",this.ready=!1,this.current=null,fetch(this.$G.api_url+"/api/saatteet/"+this.$route.params.id).then((function(t){return t.json()})).then((function(e){t.current=e,t.ready=!0})).catch((function(t){console.log("error"+t)}))):fetch(this.$G.api_url+"/api/saatteet?sort=_id").then((function(t){return t.json()})).then((function(e){t.search_result=e,t.ready=!0})).catch((function(t){console.log("error"+t)}))}},mounted:function(){this.loadData()}}),r=s,o=a("2877"),l=Object(o["a"])(r,i,n,!1,null,null,null);e["a"]=l.exports},ae77:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("b-col",[e("div",[e("WERequests")],1),e("div",[e("hr",{staticClass:"my-4"}),e("p",[t._v("by OSC/vepa")])])])},n=[],s=(a("a15b"),function(){var t=this,e=t._self._c;return e("b-container",{attrs:{fluid:""}},[e("h1",[t._v("Pyynnöt")]),t.error?e("div",{staticClass:"alert- alert-danger"},[t._v(t._s(t.error))]):t._e(),e("div",[e("h4",[t._v("uudet")]),t.ready["uusi"]?[e("b-table",{attrs:{small:"",striped:"",hover:"",items:t.new_requests,fields:t.fields},scopedSlots:t._u([{key:"cell(tiedot)",fn:function(a){return[e("b-link",{attrs:{to:{path:"/pyynnot/"+a.item._id}}},[t._v(t._s(a.item.teoksen_tiedot))])]}},{key:"cell(tilaaja)",fn:function(a){return[a.item.tilaaja?e("b-link",{attrs:{to:{path:"/asiakkaat/"+a.item.tilaaja._id}}},[t._v(t._s(a.item.tilaaja.sukunimi+", "+a.item.tilaaja.etunimi))]):e("div",[t._v(t._s(a.item.sukunimi)+", "+t._s(a.item.etunimi)+" ulkopuolinen")])]}},{key:"cell(sahkoposti)",fn:function(a){return[a.item.tilaaja?e("div",[t._v(t._s(a.item.tilaaja.sahkoposti.join(", ")))]):e("div",{staticClass:"alert alert-warning"},[t._v("ulkopuolinen")])]}}],null,!1,3739004769)})]:e("div",{staticClass:"alert alert-info"},[t._v("ei uusia pyyntöjä")])],2),e("h4",[t._v("käsittelyssä")]),t.ready["kasittelyssa"]?[e("b-table",{attrs:{small:"",striped:"",hover:"",items:t.reserved_requests,fields:t.fields},scopedSlots:t._u([{key:"cell(tiedot)",fn:function(a){return[e("b-link",{attrs:{to:{path:"/pyynnot/"+a.item._id}}},[t._v(t._s(a.item.teoksen_tiedot))])]}},{key:"cell(tilaaja)",fn:function(a){return[a.item.tilaaja?e("b-link",{attrs:{to:{path:"/asiakkaat/"+a.item.tilaaja._id}}},[t._v(t._s(a.item.tilaaja.sukunimi+", "+a.item.tilaaja.etunimi))]):e("div",[t._v(t._s(a.item.sukunimi)+", "+t._s(a.item.etunimi)+" ulkopuolinen")])]}},{key:"cell(sahkoposti)",fn:function(a){return[a.item.tilaaja?e("div",[t._v(t._s(a.item.tilaaja.sahkoposti.join(", ")))]):e("div",{staticClass:"alert alert-warning"},[t._v("ulkopuolinen")])]}}],null,!1,3739004769)})]:e("div",{staticClass:"alert alert-info"},[t._v("ei käsittelyssä olevia pyyntöjä")]),e("h4",[t._v("tilattu")]),t.ready["tilattu"]?[e("b-table",{attrs:{small:"",striped:"",hover:"",items:t.ordered_requests,fields:t.fields},scopedSlots:t._u([{key:"cell(tiedot)",fn:function(a){return[e("b-link",{attrs:{to:{path:"/pyynnot/"+a.item._id}}},[t._v(t._s(a.item.teoksen_tiedot))])]}},{key:"cell(tilaaja)",fn:function(a){return[a.item.tilaaja?e("b-link",{attrs:{to:{path:"/asiakkaat/"+a.item.tilaaja._id}}},[t._v(t._s(a.item.tilaaja.sukunimi+", "+a.item.tilaaja.etunimi))]):t._e()]}},{key:"cell(sahkoposti)",fn:function(a){return[a.item.tilaaja?e("div",[t._v(t._s(a.item.tilaaja.sahkoposti.join(", ")))]):t._e()]}}],null,!1,2542628187)})]:e("div",{staticClass:"alert alert-info"},[t._v("ei saapumattomia tilauksia")])],2)}),r=[],o=a("bc3a"),l=a.n(o),u={name:"WERequests",data:function(){return{new_requests:[],reserved_requests:[],ordered_requests:[],current:null,ready:{tilattu:!1,kasittelyssa:!1,uusi:!1},reserved_ready:!1,error:null,fields:[{key:"_id",label:"ID",thStyle:"width:10em"},{key:"teos_on",label:"tyyppi",thStyle:"width:6em"},{key:"tiedot",thStyle:"min-width:50%"},{key:"maksaja",label:"maksaja"},{key:"tilaaja",label:"asiakas"},{key:"kasittelija",label:"käsittelijä"}]}},props:["status"],watch:{current:function(){this.$G.current_request=this.current}},methods:{loadData:function(t,e,a){var i=this;l.a.get(this.$G.api_url+"/api/pyynnot?status="+t+a).then((function(a){i[e]=a.data,i[e].length?i.ready[t]=!0:i.ready[t]=!1})).catch((function(t){console.log("error"+t.response),i.error="virhe: "+t.response.data.error}))}},mounted:function(){this.loadData("uusi","new_requests",""),this.loadData("kasittelyssa","reserved_requests",""),this.loadData("tilattu","ordered_requests","")}},c=u,d=(a("5a66"),a("2877")),_=Object(d["a"])(c,s,r,!1,null,"2205b044",null),h=_.exports,p={name:"WEMain",components:{WERequests:h},data:function(){return{requests:{}}},methods:{},mounted:function(){}},k=p,m=Object(d["a"])(k,i,n,!1,null,null,null);e["a"]=m.exports},b4ac:function(t,e,a){"use strict";a("ac1f"),a("841c");var i=function(){var t=this,e=t._self._c;return e("b-container",{attrs:{fluid:""}},[e("h1",[t._v("Lainat")]),e("div",{staticClass:"alert alert-info"},[t._v("lainassa tällä hetkellä: "),e("b",[t._v(t._s(t.loan_count))])]),e("div",[e("b-tabs",{attrs:{"content-class":"mt-3"},on:{"activate-tab":function(e){return t.getOverdueLoans()}}},[e("b-tab",{attrs:{title:"lainahaku",active:""}},[e("b-row",{staticClass:"my-1"},[e("b-col",{attrs:{sm:"4"}},[e("b-form-input",{attrs:{id:"input-default",placeholder:"hakutermi"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.search_term,callback:function(e){t.search_term=e},expression:"search_term"}}),e("b-button",{on:{click:t.search}},[t._v("hae")]),t.error?e("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e()],1),e("b-col",[e("b-form-select",{attrs:{options:t.statuses},on:{change:t.search},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}})],1),e("b-col",[e("div",{staticClass:"alert alert-info"},[t._v("lainahaku hakee teoksen tiedoista. Tietyn henkilön lainat löytyy asiakashaun kautta.")])])],1),e("b-row",[0!=t.search_result.length?e("div",[e("b-table",{attrs:{small:"",striped:"",hover:"",items:t.search_result,fields:t.fields},scopedSlots:t._u([{key:"cell(teoksen_tiedot)",fn:function(a){return[e("b-link",{attrs:{to:{path:"/pyynnot/"+a.item._id}}},[t._v(t._s(a.item.teoksen_tiedot))])]}},{key:"cell(tilaaja)",fn:function(a){return[a.item.tilaaja?e("b-link",{attrs:{to:{path:"/asiakkaat/"+a.item.tilaaja._id}}},[t._v(t._s(a.item.tilaaja.sukunimi)+", "+t._s(a.item.tilaaja.etunimi))]):t._e()]}},{key:"cell(tilaus_saatu.kirjaston_nimi)",fn:function(a){return[e("div",[a.item.tilaus_saatu?e("b-link",{attrs:{to:"/kirjastot/"+a.item.tilaus_saatu.kirjasto_id}},[t._v(t._s(a.value))]):t._e()],1)]}},{key:"cell(tilaus_saatu.pvm_erapaiva)",fn:function(t){return[e("DueDate",{attrs:{item:t.item}})]}}],null,!1,1711254347)})],1):e("div",[t._v("ei tuloksia")])])],1),e("b-tab",{attrs:{title:"erääntyneet"}},[0!=t.overdue.length?[e("div",[t._v("erääntyneitä lainoja "+t._s(t.overdue.length))]),e("b-table",{attrs:{small:"",striped:"",hover:"",items:t.overdue,fields:t.fields},scopedSlots:t._u([{key:"cell(teoksen_tiedot)",fn:function(a){return[e("b-link",{attrs:{to:{path:"/pyynnot/"+a.item._id}}},[t._v(t._s(a.value))])]}},{key:"cell(tilaaja)",fn:function(a){return[e("div",[a.item.tilaaja?e("b-link",{attrs:{to:"/asiakkaat/"+a.value._id}},[t._v(t._s(a.value.etunimi)+" "+t._s(a.value.sukunimi)+" ")]):t._e()],1)]}},{key:"cell(tilaus_saatu.pvm_erapaiva)",fn:function(t){return[e("DueDate",{attrs:{item:t.item}})]}}],null,!1,3871784930)})]:t._e()],2)],1)],1)])},n=[],s=a("c7eb"),r=a("1da1"),o=(a("d3b7"),a("bc3a")),l=a.n(o),u=a("5370"),c=a("96dd"),d={name:"WELoans",components:{DueDate:u["a"]},data:function(){return{search_result:[],search_term:"",current:null,loading:!1,error:null,overdue:[],loan_count:0,status:"lainassa",statuses:["ei valintaa","kasittelyssa","lainassa","tilattu","arkistoitu","peruttu"],fields:[{key:"_id",label:"tunnus"},{key:"teoksen_tiedot",label:"kirjan nimi"},{key:"tilaaja",label:"tilaaja"},{key:"tilaus_saatu.kirjaston_nimi",label:"kirjasto"},{key:"status",label:"status"},{key:"tilaus_saatu.pvm_erapaiva",label:"eräpäivä",sortable:!0}]}},methods:{getOverdueLoans:function(){var t=this;return Object(r["a"])(Object(s["a"])().mark((function e(){var a;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,l()(t.$G.api_url+"/api/pyynnot/overdue_loans");case 2:a=e.sent,t.overdue=a.data;case 4:case"end":return e.stop()}}),e)})))()},search:function(){var t=this;if(""!=this.search_term){this.error=null;var e="";e="ei valintaa"==this.status?"?search="+this.search_term:"?search="+this.search_term+"&status="+this.status+"&sort=tilaus_saatu.pvm_erapaiva&reverse=1",fetch(this.$G.api_url+"/api/pyynnot"+e).then((function(t){if(!t.ok)throw t.status;return t.json()})).then((function(e){t.search_result=e,t.ready=!0})).catch((function(e){console.log("error"+e),t.error="virhe: "+e}))}else this.error="anna hakuehto"}},mounted:function(){var t=this;return Object(r["a"])(Object(s["a"])().mark((function e(){var a;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c["a"].getLoanCount();case 2:a=e.sent,t.loan_count=a.data;case 4:case"end":return e.stop()}}),e)})))()}},_=d,h=a("2877"),p=Object(h["a"])(_,i,n,!1,null,null,null);e["a"]=p.exports},bb25:function(t,e,a){"use strict";a("ac1f"),a("841c");var i=function(){var t=this,e=t._self._c;return e("b-container",{attrs:{fluid:""}},[e("h1",[t._v("Organisaatiot")]),t.current||""!=t.mode?t._e():e("b-card",{attrs:{title:"haku"}},[e("b-row",{staticClass:"my-1"},[e("b-col",{attrs:{sm:"4"}},[e("b-form-input",{attrs:{id:"input-default",placeholder:"hae nimen alkukirjaimilla"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.search_term,callback:function(e){t.search_term=e},expression:"search_term"}}),e("b-button",{on:{click:t.search}},[t._v("hae")])],1)],1)],1),t.current||""!=t.mode?t._e():e("b-button",{staticClass:"float-right",staticStyle:{margin:"20px"},attrs:{variant:"primary"},on:{click:function(e){t.mode="add_new"}}},[t._v("lisää uusi")]),0===t.search_result.length||t.current||""!=t.mode?t._e():e("div",[e("b-table",{attrs:{items:t.search_result,fields:t.fields},scopedSlots:t._u([{key:"cell(sahkoposti)",fn:function(a){return[e("b",{staticClass:"text-info"},[t._v(t._s(a.value))])]}},{key:"cell(nimi)",fn:function(a){return[e("b-link",{attrs:{to:"/organisaatiot/"+a.item._id}},[t._v(t._s(a.value))])]}}],null,!1,1488930706)})],1),t.current&&"edit"!=t.mode?e("b-card",{attrs:{title:t.current.nimi,"header-bg-variant":"dark"}},[e("table",t._l(t.fields,(function(a){return e("tr",{key:a.key},[e("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(a.key))]),e("td",[e("b",[t._v(t._s(t.current[a.key]))])])])})),0),"edit"!=t.mode?e("b-icon",{staticClass:"float-right pointer",attrs:{icon:"pen",variant:"primary"},on:{click:function(e){t.mode="edit"}}},[t._v("muokkaa")]):t._e()],1):t._e(),t.current&&"edit"==t.mode?e("b-card",{attrs:{title:t.current.nimi,"header-bg-variant":"dark"}},["edit"==t.mode?e("table",t._l(t.fields,(function(a){return e("tr",{key:a.key},[e("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(a.key))]),e("td",[e("b-form-input",{model:{value:t.current[a.key],callback:function(e){t.$set(t.current,a.key,e)},expression:"current[field.key]"}})],1)])})),0):t._e(),e("b-container",[e("b-button",{staticClass:"float-right",staticStyle:{"margin-left":"20px"},attrs:{variant:"primary"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")]),e("b-button",{staticClass:"float-right",on:{click:function(e){return t.loadData()}}},[t._v("peru")])],1)],1):t._e(),t.current?e("b-link",{attrs:{to:"/organisaatiot"}},[t._v("takaisin hakuun")]):t._e(),"add_new"==t.mode?e("b-card",{attrs:{title:"uusi organisaatio","header-bg-variant":"dark"}},[e("table",t._l(t.fields,(function(a){return e("tr",{key:a.key},[e("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(a.key))]),e("td",[e("b-form-input",{model:{value:t.new_obj[a.key],callback:function(e){t.$set(t.new_obj,a.key,e)},expression:"new_obj[field.key]"}})],1)])})),0),e("b-button",{staticClass:"float-right",staticStyle:{"margin-left":"20px"},attrs:{variant:"primary"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")]),e("b-button",{staticClass:"float-right",on:{click:function(e){t.mode=""}}},[t._v("peru")])],1):t._e(),e("br"),e("br"),t.current?e("h2",[t._v("maksut")]):t._e(),t.current?e("b-card",[e("b-table",{attrs:{items:t.requests,fields:t.request_fields},scopedSlots:t._u([{key:"cell(tiedot)",fn:function(a){return[e("b-link",{attrs:{to:"/pyynnot/"+a.item._id}},[t._v(t._s(a.item.teoksen_tiedot))])]}},{key:"cell(tilaaja)",fn:function(a){return[e("b-link",{attrs:{to:"/asiakkaat/"+a.item.tilaaja._id}},[t._v(t._s(a.value.sukunimi)+", "+t._s(a.value.etunimi))])]}}],null,!1,2186137256)})],1):t._e()],1)},n=[],s=a("c7eb"),r=a("1da1"),o=(a("d3b7"),a("e9c4"),a("14d9"),a("caad"),a("2532"),{name:"WEOrganisation",data:function(){return{search_term:"",search_result:[],current:null,requests:[],ready:!1,mode:"",new_obj:{},fields:[{key:"nimi"},{key:"kustannuspaikka"},{key:"huomio",label:"lisätieto"}],request_fields:[{key:"_id",label:"tunniste"},{key:"teos_on",label:"tyyppi"},{key:"tiedot"},{key:"tilaaja"},{key:"kasittelija",label:"käsittelijä"},{key:"status"},{key:"maksu"},{key:"maksaja_info"}]}},watch:{$route:function(t,e){this.$route.params.id?this.loadData():this.current=null}},methods:{saveForm:function(){var t=this;console.log("saveform"),"add_new"==this.mode?fetch(this.$G.api_url+"/api/organisaatiot",{method:"POST",body:JSON.stringify(this.new_obj)}).then((function(t){return t.json()})).then((function(e){t.$router.push("/organisaatiot/"+e._id)})).catch((function(t){console.log("error"+t)})):"edit"==this.mode&&(console.log("edit"),delete this.current._id,console.log(this.current),fetch(this.$G.api_url+"/api/organisaatiot/"+this.$route.params.id,{method:"PUT",body:JSON.stringify(this.current)}).then((function(t){return t.json()})).then((function(e){t.loadData()})).catch((function(t){console.log("error"+t)})))},editForm:function(){console.log(this.edit),console.log("sdf"),this.edit=!this.edit},loadRelated:function(){var t=this;fetch(this.$G.api_url+"/api/pyynnot/?sort=_id&reverse=1&maksaja_varmistettu="+this.$route.params.id).then((function(t){return t.json()})).then((function(e){t.requests=e,t.ready=!0})).catch((function(t){console.log("error"+t)}))},loadData:function(){var t=this;this.$route.params.id&&(this.mode="",this.ready=!1,this.current=null,fetch(this.$G.api_url+"/api/organisaatiot/"+this.$route.params.id).then((function(t){return t.json()})).then((function(e){t.current=e,t.loadRelated()})).catch((function(t){console.log("error"+t)})))},search:function(){var t=this;return Object(r["a"])(Object(s["a"])().mark((function e(){var a,i;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.current=null,""===t.search_term){e.next=10;break}return t.search_term.includes("*")||(t.search_term=t.search_term+"*"),a="nimi="+t.search_term,e.next=6,fetch(t.$G.api_url+"/api/organisaatiot?"+a);case 6:return i=e.sent,e.next=9,i.json();case 9:t.search_result=e.sent;case 10:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.loadData()}}),l=o,u=a("2877"),c=Object(u["a"])(l,i,n,!1,null,null,null);e["a"]=c.exports},ccd2:function(t,e,a){"use strict";a("ac1f"),a("841c");var i=function(){var t=this,e=t._self._c;return e("b-container",{attrs:{fluid:""}},[e("h1",[t._v("Kirjastot")]),t.current||""!=t.mode?t._e():e("b-card",{attrs:{title:"haku"}},[e("b-row",{staticClass:"my-1"},[e("b-col",{attrs:{sm:"4"}},[e("b-form-input",{attrs:{id:"input-default",placeholder:"hae nimen alkukirjaimilla"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.search_term,callback:function(e){t.search_term=e},expression:"search_term"}}),e("label",[t._v("TAI ")]),e("b-form-input",{attrs:{id:"input-default2",placeholder:"hae lyhenteellä"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.search_lyhenne,callback:function(e){t.search_lyhenne=e},expression:"search_lyhenne"}}),e("b-button",{on:{click:t.search}},[t._v("hae")])],1)],1)],1),e("br"),t.current||""!=t.mode?t._e():e("b-button",{staticClass:"float-right",attrs:{variant:"primary"},on:{click:function(e){t.mode="add_new"}}},[t._v("lisää uusi")]),t.loading?e("div",{staticClass:"alert alert-info"},[t._v("haen...")]):t._e(),0===t.search_result.length||t.current||""!=t.mode?t._e():e("div",[e("b-table",{attrs:{items:t.search_result,fields:t.fields_search},scopedSlots:t._u([{key:"cell(sahkoposti)",fn:function(a){return[e("b",{staticClass:"text-info"},[t._v(t._s(a.value))])]}},{key:"cell(nimi)",fn:function(a){return[e("b-link",{attrs:{to:"/kirjastot/"+a.item._id}},[t._v(t._s(a.value))])]}}],null,!1,1824578108)})],1),t.current&&"edit"!=t.mode?e("b-card",{attrs:{title:t.current.nimi+" ("+t.current.lyhenne+")","header-bg-variant":"dark"}},[e("table",{staticClass:"table table-sm"},t._l(t.fields,(function(a){return e("tr",{key:a.key},[e("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(a.key))]),"lomake"==a.key||"kotisivut"==a.key?e("td",[e("a",{attrs:{target:"_blank",href:t.getLink(t.current[a.key])}},[t._v(t._s(t.current[a.key]))])]):e("td",[e("b",[t._v(t._s(t.current[a.key]))])])])})),0),"edit"!=t.mode?e("b-icon",{staticClass:"float-right pointer",attrs:{icon:"pen",variant:"primary"},on:{click:function(e){t.mode="edit"}}},[t._v("muokkaa")]):t._e()],1):t._e(),t.current&&"edit"==t.mode?e("b-card",{attrs:{title:t.current.nimi,"header-bg-variant":"dark"}},[e("table",{staticClass:"table table-striped"},t._l(t.fields,(function(a){return e("tr",{key:a.key},["_id"!=a.key?[a.label?e("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(a.label))]):e("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(a.key))]),e("td",{staticStyle:{"min-width":"350px"}},[e("b-form-input",{model:{value:t.current[a.key],callback:function(e){t.$set(t.current,a.key,e)},expression:"current[field.key]"}})],1)]:t._e()],2)})),0),e("b-container",[e("b-button",{staticClass:"float-right",staticStyle:{"margin-left":"20px"},attrs:{variant:"primary"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")]),e("b-button",{staticClass:"float-right",on:{click:function(e){return t.loadData()}}},[t._v("peru")])],1)],1):t._e(),t.current?e("b-link",{attrs:{to:"/kirjastot"}},[t._v("takaisin hakuun")]):t._e(),"add_new"==t.mode?e("b-card",{attrs:{title:"uusi kirjasto","header-bg-variant":"dark"}},[e("table",t._l(t.fields,(function(a){return e("tr",{key:a.key},[a.label?e("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(a.label))]):e("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(a.key))]),e("td",{staticStyle:{"min-width":"350px"}},[e("b-form-input",{model:{value:t.new_obj[a.key],callback:function(e){t.$set(t.new_obj,a.key,e)},expression:"new_obj[field.key]"}})],1)])})),0),e("b-button",{on:{click:function(e){t.mode=""}}},[t._v("peru")]),e("b-button",{attrs:{variant:"info"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")])],1):t._e(),t.error?e("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e(),e("br"),e("br"),t.current?e("h2",[t._v("lainassa olevat")]):t._e(),t.current?e("b-card",[e("b-table",{attrs:{items:t.requests,fields:t.request_fields},scopedSlots:t._u([{key:"cell(tiedot)",fn:function(a){return[e("b-link",{attrs:{to:"/pyynnot/"+a.item._id}},[t._v(t._s(a.item.teoksen_tiedot))])]}},{key:"cell(tilaaja)",fn:function(a){return[a.item.tilaaja?e("b-link",{attrs:{to:{path:"/asiakkaat/"+a.item.tilaaja._id}}},[t._v(t._s(a.item.tilaaja.sukunimi)+", "+t._s(a.item.tilaaja.etunimi))]):t._e()]}},{key:"cell(erapaiva)",fn:function(t){return[e("DueDate",{attrs:{item:t.item}})]}}],null,!1,458813704)})],1):t._e(),t.current?e("h2",[t._v("arkistoidut")]):t._e(),t.current?e("b-card",[e("b-button",{on:{click:function(e){return t.loadArchive()}}},[t._v("näytä arkistoidut")]),e("b-table",{attrs:{items:t.archived,fields:t.request_fields},scopedSlots:t._u([{key:"cell(tiedot)",fn:function(a){return[e("b-link",{attrs:{to:"/pyynnot/"+a.item._id}},[t._v(t._s(a.item.teoksen_tiedot))])]}},{key:"cell(tilaaja)",fn:function(a){return[a.item.tilaaja?e("b-link",{attrs:{to:{path:"/asiakkaat/"+a.item.tilaaja._id}}},[t._v(t._s(a.item.tilaaja.sukunimi)+", "+t._s(a.item.tilaaja.etunimi))]):t._e()]}},{key:"cell(erapaiva)",fn:function(t){return[e("DueDate",{attrs:{item:t.item}})]}}],null,!1,458813704)})],1):t._e()],1)},n=[],s=a("c7eb"),r=a("1da1"),o=(a("caad"),a("2532"),a("5319"),a("d3b7"),a("e9c4"),a("14d9"),a("5370")),l={name:"WELibrary",components:{DueDate:o["a"]},data:function(){return{search_term:"",search_lyhenne:"",search_result:[],archived:[],current:null,requests:[],ready:!1,loading:!1,error:null,mode:"",new_obj:{},fields_search:[{key:"nimi"},{key:"lyhenne"},{key:"email",label:"sähköposti"},{key:"puhelin"}],fields:[{key:"nimi"},{key:"puhelin"},{key:"lyhenne"},{key:"email",label:"sähköposti"},{key:"osoite"},{key:"huomio"},{key:"lomake",label:"tilauslomakkeen URL"},{key:"kotisivut",label:"kotisivujen URL"}],request_fields:[{key:"_id",label:"tunniste"},{key:"tiedot"},{key:"status"},{key:"tilaaja",label:"asiakas"},{key:"erapaiva",label:"eräpäivä"}]}},watch:{$route:function(t,e){t.path.includes("/kirjastot")&&(this.$route.params.id?this.loadData():e.path.includes("/kirjastot")?this.current=null:this.current&&this.$router.replace({path:"/kirjastot/"+this.current._id}))}},methods:{getLink:function(t){if(t)return t.includes("http")?t:"http://"+t},saveForm:function(){var t=this;if(console.log("saveform"),"add_new"==this.mode){if(!this.new_obj.nimi||""==this.new_obj.nimi)return void alert("Nimi täytyy antaa");fetch(this.$G.api_url+"/api/kirjastot",{method:"POST",body:JSON.stringify(this.new_obj)}).then((function(t){return t.json()})).then((function(e){t.$router.push("/kirjastot/"+e._id)})).catch((function(t){console.log("error"+t)}))}else"edit"==this.mode&&(delete this.current._id,fetch(this.$G.api_url+"/api/kirjastot/"+this.$route.params.id,{method:"PUT",body:JSON.stringify(this.current)}).then((function(t){return t.json()})).then((function(e){t.loadData()})).catch((function(t){console.log("error"+t)})))},editForm:function(){console.log(this.edit),this.edit=!this.edit},loadData:function(){var t=this;this.$route.params.id&&(this.mode="",this.error=null,this.ready=!1,this.loading=!0,this.current=null,this.archived=[],fetch(this.$G.api_url+"/api/kirjastot/"+this.$route.params.id).then((function(t){return t.json()})).then((function(e){t.current=e,t.loadRelated()})).catch((function(e){t.error=e,console.log("error"+e)})))},loadRelated:function(){var t=this;fetch(this.$G.api_url+"/api/kirjastot/"+this.$route.params.id+"/loans").then((function(t){return t.json()})).then((function(e){t.requests=e,t.ready=!0,t.loading=!1})).catch((function(t){console.log("error"+t)}))},loadArchive:function(){var t=this;return Object(r["a"])(Object(s["a"])().mark((function e(){var a;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,fetch(t.$G.api_url+"/api/kirjastot/"+t.$route.params.id+"/loans?status=arkistoitu");case 2:return a=e.sent,e.next=5,a.json();case 5:t.archived=e.sent;case 6:case"end":return e.stop()}}),e)})))()},search:function(){var t=this;return Object(r["a"])(Object(s["a"])().mark((function e(){var a,i,n;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.current=null,t.error=null,t.loading=!0,a="",""===t.search_term){e.next=16;break}return t.search_term.includes("*")||(t.search_term=t.search_term+"*"),a="nimi="+t.search_term,e.next=9,fetch(t.$G.api_url+"/api/kirjastot?"+a);case 9:return i=e.sent,e.next=12,i.json();case 12:t.search_result=e.sent,t.loading=!1,e.next=25;break;case 16:if(""===t.search_lyhenne){e.next=25;break}return a="lyhenne="+t.search_lyhenne,e.next=20,fetch(t.$G.api_url+"/api/kirjastot?"+a);case 20:return n=e.sent,e.next=23,n.json();case 23:t.search_result=e.sent,t.loading=!1;case 25:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.loadData()}},u=l,c=a("2877"),d=Object(c["a"])(u,i,n,!1,null,null,null);e["a"]=d.exports},da62:function(t,e,a){},df45:function(t,e,a){"use strict";a("a15b"),a("ac1f"),a("5319");var i=function(){var t=this,e=t._self._c;return e("b-container",[t.ready?e("div",[e("b-card",{attrs:{header:"kaukolainapyyntö"},scopedSlots:t._u([{key:"header",fn:function(){return[e("b-nav",{staticClass:"float-right"},[e("b-nav-item-dropdown",{attrs:{id:"my-nav-dropdown",text:"toiminnot","toggle-class":"nav-link-custom",right:""}},["lainassa"==t.request.status?e("b-dropdown-item",{staticClass:"float-right",on:{click:function(e){return t.setReturned()}}},[e("b",[t._v("merkitse palautetuksi ja arkistoi")])]):t._e(),t.request.tilaus_saatu&&"lainassa"==t.request.tilaus_saatu.status?e("b-dropdown-item",{on:{click:function(e){return t.openKarhuRequest()}}},[t._v("lähetä karhuviesti")]):t._e(),"kasittelyssa"==t.request.status||"tilattu"==t.request.status||"uusi"==t.request.status?e("b-dropdown-item",{on:{click:function(e){t.show=!t.show}}},[e("b",[t._v("tee uusi tilaus")])]):t._e(),e("b-dropdown-divider"),"kasittelyssa"!=t.request.status&&"tilattu"!=t.request.status||"artikkeli"!=t.request.teos_on?t._e():e("b-dropdown-item",{on:{click:function(e){return t.convertToBook()}}},[t._v("muuta kirjapyynnöksi")]),"peruttu"!==t.request.status||t.request.tilaus_saatu?t._e():e("b-dropdown-item",{on:{click:function(e){t.show_modal_cancel_archive=!0}}},[t._v("palauta käsittelyyn")]),"peruttu"==t.request.status||t.request.tilaus_saatu?t._e():e("b-dropdown-item",{on:{click:function(e){return t.openCancelRequest()}}},[t._v("peruuta pyyntö")])],1)],1),e("h3",[t._v(t._s(t.request.teos_on)+"pyyntö: "),e("b",[t._v(t._s(t.request._id))]),t._v(" ("),e("span",{staticClass:"text-info"},[t._v(t._s(t.$G.getStatus(t.request.status)))]),t._v(")")])]},proxy:!0}],null,!1,2560333342)},[e("b-card-body",[e("b-card-title",[t._v(t._s(t.request.teoksen_tiedot)+" "),"arkistoitu"!=t.request.status?e("b-icon",{staticClass:"float-right cursor",attrs:{icon:"pen",variant:"primary",id:"edit-note"},on:{click:function(e){t.show_modal_title=!0}}}):t._e()],1),e("table",{staticClass:"table"},[e("tbody",[t.request.tilaaja?e("tr",[e("td",{staticStyle:{width:"200px"}},[t._v("asiakas")]),e("td",[e("b",[e("b-link",{attrs:{to:"/asiakkaat/"+t.request.tilaaja._id}},[t._v(t._s(t.request.tilaaja.etunimi)+" "+t._s(t.request.tilaaja.sukunimi)+" ")])],1),t.request.tilaaja.sukunimi&&""!=t.request.tilaaja.sukunimi?t._e():e("b-link",{attrs:{to:"/asiakkaat/"+t.request.tilaaja._id}},[t._v("nimi puuttuu ")]),t.isExternal()?e("div",[e("p",{staticClass:"alert alert-warning"},[t._v("Kaukolainapyyntö on tehty kaukolainahenkilökunnan tunnuksilla, joten asiakas täytyy liittää pyyntöön käsin (ja mahdollisesti lisätä sähköposti) tai luoda uusi asiakas.")]),e("p",[e("b",[t._v(t._s(t.request.sukunimi)+", "+t._s(t.request.etunimi))])]),e("p",[e("b-input",{nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchClients()}},model:{value:t.client_query,callback:function(e){t.client_query=e},expression:"client_query"}}),e("b-button",{on:{click:function(e){return t.searchClients()}}},[t._v("hae")])],1),t.clients_result&&t.clients_result.length?[e("b-table",{attrs:{small:"",striped:"",hover:"",items:t.clients_result,fields:t.client_fields},scopedSlots:t._u([{key:"cell(sahkoposti)",fn:function(e){return[t._v(" "+t._s(e.value.join(", "))+" ")]}},{key:"cell(valitse)",fn:function(a){return[e("b-button",{attrs:{title:"liitä asiakas ja anna tarvittaessa toinen sähköposti",variant:"primary"},on:{click:function(e){return t.openJoinClient(a.item)}}},[t._v("liitä")])]}}],null,!1,1859691286)})]:e("div",[t._v("ei tuloksia")]),e("b-button",{staticClass:"float-right",staticStyle:{"margin-top":"40px"},attrs:{variant:"primary"},on:{click:function(e){t.show_modal_external=!t.show_modal_external}}},[t._v("Luo uusi asiakas")])],2):t._e()],1),e("td")]):e("tr",[e("td",[t._v("asiakas")]),e("td",[t.isExternal()?e("div",[e("p",[e("b",[t._v(t._s(t.request.sukunimi)+", "+t._s(t.request.etunimi))])]),e("p",{staticClass:"alert alert-warning"},[t._v("Kaukolainapyyntö on tehty kaukolainahenkilökunnan tunnuksilla, joten asiakas täytyy liittää pyyntöön käsin (ja mahdollisesti lisätä sähköposti) tai luoda uusi asiakas.")]),e("p",[e("b-input",{nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchClients()}},model:{value:t.client_query,callback:function(e){t.client_query=e},expression:"client_query"}}),e("b-button",{on:{click:function(e){return t.searchClients()}}},[t._v("hae")])],1),t.clients_result&&t.clients_result.length?[e("b-table",{attrs:{small:"",striped:"",hover:"",items:t.clients_result,fields:t.client_fields},scopedSlots:t._u([{key:"cell(sahkoposti)",fn:function(e){return[t._v(" "+t._s(e.value.join(", "))+" ")]}},{key:"cell(valitse)",fn:function(a){return[e("b-button",{attrs:{title:"liitä asiakas ja anna tarvittaessa toinen sähköposti",variant:"primary"},on:{click:function(e){return t.openJoinClient(a.item)}}},[t._v("liitä")])]}}],null,!1,1859691286)})]:e("div",[t._v("ei tuloksia")]),e("b-button",{staticClass:"float-right",staticStyle:{"margin-top":"40px"},attrs:{variant:"primary"},on:{click:function(e){t.show_modal_external=!t.show_modal_external}}},[t._v("Luo uusi asiakas")])],2):t._e()]),e("td")]),"artikkeli"==t.request.teos_on?[e("tr",[e("td",{staticStyle:{"min-width":"200px"}},[t._v("mistä löysit?")]),e("td",[e("b",[t._v(t._s(t.request.mista_loysit_julkaisun_tiedot))])]),e("td")])]:t._e(),e("tr",[e("td",[t._v(" maksaja ")]),e("td",[t.request.hintakatto?e("b-badge",{staticClass:"float-right alert alert-info"},[t._v("hintakatto: "+t._s(t.request.hintakatto))]):t._e(),t.request.maksaja_varmistettu||"asiakas"==t.request.maksaja?t._e():e("div",{staticClass:"alert alert-warning"},[t._v("maksajaa ei ole liitetty mihinkään organisaatioon")]),"asiakas"==t.request.maksaja?e("div",[e("b",[t._v("asiakas itse")])]):t.request.maksaja_varmistettu?e("div",[e("span",{attrs:{title:"lomakkeelta tullut maksajatieto"}},[t._v(t._s(t.request.laitos)+": ")]),e("b-link",{attrs:{title:"linkitetty maksajatieto",to:"/organisaatiot/"+t.request.maksaja_varmistettu._id}},[t._v(t._s(t.request.maksaja_varmistettu.nimi))])],1):e("div",[t.request.maksaja_varmistettu?t._e():e("b",[t._v(" "+t._s(t.request.maksaja)+": "+t._s(t.request.laitos)+" "+t._s(t.request.projekti))])]),t.request.maksaja_varmistettu?e("div",[e("table",{staticClass:"table table-striped"},[e("tbody",[t.request.projekti?e("tr",[e("td",[t._v("projekti:")]),e("td",[e("b",[t._v(" "+t._s(t.request.projekti))])])]):t._e(),t.request.kustannuspaikka?e("tr",[e("td",[t._v("kustannuspaikka:")]),e("td",[e("b",[t._v(" "+t._s(t.request.kustannuspaikka))])])]):t._e()])]),t.request.maksaja_info&&t.request.maksaja_varmistettu?e("div",{staticClass:"alert alert-info"},[t._v(t._s(t.request.maksaja_info))]):t._e()]):t._e()],1),e("td",{attrs:{title:"muokkaa maksajatietoja"}},["arkistoitu"!=t.request.status?e("b-icon",{staticClass:"float-right cursor",attrs:{icon:"pen",variant:"primary",id:"edit-note"},on:{click:function(e){t.show_modal_payer=!0}}}):t._e()],1)]),e("tr",[e("td",{staticStyle:{"min-width":"200px"}},[t._v("huomautuksia "),e("br"),t._v("(sisäinen)")]),e("td",[""!=t.request.huomautuksia?e("div",{staticClass:"alert alert-info",domProps:{innerHTML:t._s(t.$G.renderBreaks(t.request.huomautuksia,"\n"))}}):t._e()]),e("td",{attrs:{title:"muokkaa huomautuksia"}},[e("b-icon",{staticClass:"float-right cursor",attrs:{icon:"pen",variant:"primary",id:"edit-note"},on:{click:function(e){t.show_modal_note=!t.show_modal_note}}})],1)])],2)]),t.request.tarvitaan_viimeistaan?e("div",{staticClass:"alert alert-info"},[t._v("tarvitaan viimeistään: "+t._s(t.request.tarvitaan_viimeistaan))]):t._e(),t.request.o_id?e("div",{staticClass:"alert alert-danger"},[t._v("Vanha laina Kakesta!")]):t._e(),t.request.peruutuksen_syy?e("div",[t._v("peruutuksen syy: "),e("b",{staticClass:"text-danger"},[t._v(t._s(t.request.peruutuksen_syy)+" ")])]):t._e(),"yes"==t.request.o_retudate_has_value?e("div",{staticClass:"alert alert-info"},[t._v("Tämä lienee palautettu "+t._s(t.request.pvm_palautettu)+"?")]):t._e(),t.request.karhut&&t.request.karhut.length?e("div",t._l(t.request.karhut,(function(a){return e("div",{key:a,staticClass:"alert alert-danger"},[t._v(" karhuttu: "+t._s(a)+" ")])})),0):t._e()],1)],1),e("br"),"lainassa"!=t.request.status&&"arkistoitu"!=t.request.status||!t.request.tilaus_saatu?t._e():e("b-card",{attrs:{footer:"palautettu: "+t.formatDate(t.request.tilaus_saatu.pvm_palautettu,"reverse","."),"header-class":"dim","header-text-variant":"white"},scopedSlots:t._u([{key:"header",fn:function(){return[e("h6",{staticClass:"mb-0"},[e("b",[t._v("kaukolaina")]),t._v(" (saapunut: "+t._s(t.formatDate(t.request.tilaus_saatu.pvm_saapunut,"reverse","."))+")")])]},proxy:!0}],null,!1,3341928750)},[e("table",{staticClass:"table"},[e("tr",[e("td",[t._v("kirjastosta")]),e("td",[e("b-link",{attrs:{"text-variant":"white",to:"/kirjastot/"+t.request.tilaus_saatu.kirjasto_id}},[t._v(" "+t._s(t.request.tilaus_saatu.kirjaston_nimi))])],1),e("td")]),"kirja"==t.request.teos_on?e("tr",[e("td",{staticStyle:{width:"200px"}},[t._v("eräpäivä")]),e("td",[e("DueDate",{attrs:{item:t.request}})],1),e("td",{attrs:{title:"muokkaa eräpäivää"},on:{click:function(e){t.show_modal_loan_date=!0}}},[e("b-icon",{staticClass:"float-right cursor",attrs:{icon:"pen",variant:"primary",id:"edit-note"}})],1)]):t._e(),e("tr",[e("td",{staticStyle:{width:"200px"}},[t._v("maksu")]),e("td",[t._v(t._s(t.request.tilaus_saatu.maksu))]),e("td")]),e("tr",[e("td",{staticStyle:{width:"200px"}},[t._v("tilausviesti")]),e("td",[e("div",{staticClass:"cursor",attrs:{size:"sm"},on:{click:function(e){return t.$root.$emit("bv::toggle::collapse",t.request.tilaus_saatu._id)}}},[e("b-icon",{attrs:{icon:"caret-right"}}),t._v("tilausviesti")],1),e("b-collapse",{attrs:{id:t.request.tilaus_saatu._id,accordion:"my-accordion",role:"tabpanel"}},[e("div",{domProps:{innerHTML:t._s(t.$G.renderBreaks(t.request.tilaus_saatu.viesti,"\n"))}})])],1),e("td")])])]),e("br"),t.orders.length?e("div",[e("b-table",{staticClass:"table table-striped",attrs:{items:t.orders,fields:t.order_fields},scopedSlots:t._u([{key:"cell(kirjaston_nimi)",fn:function(a){return[e("div",{staticStyle:{"min-width":"350px"}},[e("b-link",{attrs:{to:"/kirjastot/"+a.item.kirjasto_id}},[t._v(" "+t._s(a.value))]),e("div",{staticClass:"cursor",attrs:{size:"sm"},on:{click:function(e){return t.$root.$emit("bv::toggle::collapse",a.item._id)}}},[e("b-icon",{attrs:{icon:"caret-right"}}),t._v("tilausviesti")],1),e("b-collapse",{attrs:{id:a.item._id,accordion:"my-accordion",role:"tabpanel"}},[e("div",{domProps:{innerHTML:t._s(t.$G.renderBreaks(a.item.viesti,"\n"))}})])],1)]}},{key:"cell(pvm)",fn:function(a){return[a.item.recdate?e("div",[t._v(t._s(a.item.recdate))]):e("div",[t._v(t._s(t.$G.getDateFromUUID(a.item._id)))])]}},{key:"cell(pvm_saapunut)",fn:function(a){return[e("div",[t._v(t._s(t.formatDate(a.value)))])]}},{key:"cell(pvm_palautettu)",fn:function(a){return[e("b",{staticClass:"text text-info"},[t._v(t._s(t.formatDate(a.value)))])]}},{key:"cell(status)",fn:function(a){return[e("b",{staticClass:"text text-info"},[t._v(t._s(a.value.replace("_"," ")))])]}},{key:"cell(toiminto)",fn:function(a){return["arkistoitu"!==t.request.status?e("b-nav",{staticClass:"float-right"},["palautettu"!==a.item.status&&"ei_saatavilla"!==a.item.status?e("b-nav-item-dropdown",{attrs:{id:"tilaus-nav-dropdown",text:"toiminnot","toggle-class":"nav-link-custom",right:""}},[e("b-dropdown-divider"),"kasittelyssa"!=t.request.status&&"tilattu"!=t.request.status||"kirja"!=t.request.teos_on?t._e():e("b-dropdown-item",{staticClass:"float-right",attrs:{variant:"primary"},on:{click:function(e){return t.openArrived(a.item)}}},[t._v("merkitse saapuneeksi ja lainaa")]),"kasittelyssa"!=t.request.status&&"tilattu"!=t.request.status||"artikkeli"!=t.request.teos_on?t._e():e("b-dropdown-item",{staticClass:"float-right",attrs:{variant:"primary"},on:{click:function(e){return t.openArrived(a.item)}}},[t._v("merkitse saapuneeksi ja arkistoi")]),a.item.status&&"tilattu"!=a.item.status?t._e():e("b-dropdown-item",{on:{click:function(e){return t.setNotAvailable(a.item._id)}}},[t._v("ei saatavilla")])],1):t._e()],1):t._e()]}}],null,!1,1422393677)})],1):t._e(),t.error?e("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e(),e("b-modal",{attrs:{title:"muuta eräpäivää","cancel-title":"peru","ok-title":"tallenna","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:t.setLoanDate},model:{value:t.show_modal_loan_date,callback:function(e){t.show_modal_loan_date=e},expression:"show_modal_loan_date"}},[t.request.tilaus_saatu?e("div",{staticClass:"alert alert-info"},[t._v("nykyinen eräpäivä: "+t._s(t.formatDate(t.request.tilaus_saatu.pvm_erapaiva,"reverse",".")))]):t._e(),t._v(" uusi eräpäivä: "),e("b-input",{model:{value:t.new_loan_date,callback:function(e){t.new_loan_date=e},expression:"new_loan_date"}}),e("b-form-checkbox",{attrs:{id:"checkbox-ei-peruutusviestia",name:"checkbox-ei-peruutusviestia",value:"no","unchecked-value":"yes"},on:{change:function(e){return t.setDueDate()}},model:{value:t.tilaus_uusittavissa,callback:function(e){t.tilaus_uusittavissa=e},expression:"tilaus_uusittavissa"}},[t._v(" ei voi enää uusia ")]),"no"==t.tilaus_uusittavissa?[t._v("lisätieto: "),e("b-input",{model:{value:t.tilaus_info,callback:function(e){t.tilaus_info=e},expression:"tilaus_info"}})]:t._e()],2),e("b-modal",{attrs:{title:"Muokkaa otsikkoa","cancel-title":"peru","ok-title":"tallenna","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:t.updateTitle},model:{value:t.show_modal_title,callback:function(e){t.show_modal_title=e},expression:"show_modal_title"}},[e("b-form-textarea",{attrs:{rows:"3"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t.sending?e("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],1),e("b-modal",{attrs:{title:"Lähetä karhuviesti","cancel-title":"peru","ok-title":"lähetä","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:t.sendDueNotice},model:{value:t.show_modal_due_notice,callback:function(e){t.show_modal_due_notice=e},expression:"show_modal_due_notice"}},[t._v(" karhuviesti asiakkaalle: "),e("b-form-textarea",{attrs:{rows:"6"},model:{value:t.due_notice,callback:function(e){t.due_notice=e},expression:"due_notice"}}),t.sending?e("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],1),e("b-modal",{attrs:{title:"peruuta kaukolainapyyntö","cancel-title":"peru","ok-title":"merkitse peruutetuksi","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:function(e){return t.setCancelled()}},model:{value:t.show_modal_cancel_request,callback:function(e){t.show_modal_cancel_request=e},expression:"show_modal_cancel_request"}},["lainassa"==t.request.status?e("div",{staticClass:"alert alert-danger"},[t._v("Teos on lainassa! ")]):t._e(),"yes"===t.laheta_peruutusilmoitus?[t._v(" peruutusviesti asiakkaalle: "),e("b-form-textarea",{attrs:{rows:"6"},model:{value:t.cancel_reason,callback:function(e){t.cancel_reason=e},expression:"cancel_reason"}})]:t._e(),e("b-form-checkbox",{attrs:{id:"checkbox-ei-peruutusviestia",name:"checkbox-ei-peruutusviestia",value:"yes","unchecked-value":"no"},model:{value:t.laheta_peruutusilmoitus,callback:function(e){t.laheta_peruutusilmoitus=e},expression:"laheta_peruutusilmoitus"}},[t._v(" lähetä sähköposti-ilmoitus asiakkaalle ")]),t.sending?e("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],2),e("b-modal",{attrs:{title:"palauta käsittelyyn","cancel-title":"peru","ok-title":"palauta käsittelyyn","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:function(e){return t.setNonArchived()}},model:{value:t.show_modal_cancel_archive,callback:function(e){t.show_modal_cancel_archive=e},expression:"show_modal_cancel_archive"}},[t.sending?e("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()]),e("b-modal",{attrs:{size:"lg",title:"merkitse saapuneeksi","cancel-title":"peru","ok-title":"merkitse saapuneeksi","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:t.setArrived},model:{value:t.show_modal_arrived,callback:function(e){t.show_modal_arrived=e},expression:"show_modal_arrived"}},[t.arrived_order?e("b-form-group",{staticStyle:{"max-width":"450px"}},["kirja"==t.request.teos_on?[e("label",[t._v("eräpäivä (pp.kk.vvvv)")]),e("b-input",{model:{value:t.arrived_order.erapaiva,callback:function(e){t.$set(t.arrived_order,"erapaiva",e)},expression:"arrived_order.erapaiva"}})]:t._e(),e("label",[t._v("maksu")]),e("b-input",{model:{value:t.arrived_order.maksu,callback:function(e){t.$set(t.arrived_order,"maksu",e)},expression:"arrived_order.maksu"}}),e("b-form-checkbox",{attrs:{id:"checkbox-2",name:"checkbox-2",value:"yes","unchecked-value":"no"},model:{value:t.laheta_saapumisilmoitus,callback:function(e){t.laheta_saapumisilmoitus=e},expression:"laheta_saapumisilmoitus"}},[t._v(" lähetä saapumisilmoitus ")])],2):t._e(),t.sending?e("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e(),t.error?e("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e()],1),e("b-modal",{attrs:{size:"lg",title:"huomautuksia","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:t.setNote,cancel:function(e){t.note=t.request.huomautuksia}},model:{value:t.show_modal_note,callback:function(e){t.show_modal_note=e},expression:"show_modal_note"}},[e("b-form-textarea",{attrs:{id:"textarea",placeholder:"",rows:"10"},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}}),t.sending?e("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],1),e("b-modal",{attrs:{size:"lg",title:"tilauslomake","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},scopedSlots:t._u([{key:"modal-footer",fn:function(){return[e("div")]},proxy:!0}],null,!1,2017372688),model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[e("WEOrderForm",{attrs:{request:t.request},on:{exit:function(e){return t.loadData()}}})],1),e("b-modal",{attrs:{size:"lg",title:"maksaja","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:t.setPayer,cancel:t.cancelPayer},model:{value:t.show_modal_payer,callback:function(e){t.show_modal_payer=e},expression:"show_modal_payer"}},[e("b-form-checkbox",{attrs:{id:"checkbox-1",name:"checkbox-1",value:"yes","unchecked-value":"no"},model:{value:t.payer_is_client,callback:function(e){t.payer_is_client=e},expression:"payer_is_client"}},[t._v(" asiakas maksaa itse ")]),"yes"!=t.payer_is_client?e("b-form",[e("b-form-group",{staticStyle:{"margin-top":"30px"}},[e("label",[t._v("valitse maksaja")]),e("b-select",{attrs:{options:t.organisations,"value-field":"_id","text-field":"nimi"},model:{value:t.payer_selected,callback:function(e){t.payer_selected=e},expression:"payer_selected"}}),t.payer_selected?e("b-form-textarea",{attrs:{id:"textarea",placeholder:"Lisätietoa maksuun liittyen...",rows:"3","max-rows":"6"},model:{value:t.payer_info,callback:function(e){t.payer_info=e},expression:"payer_info"}}):t._e()],1)],1):t._e(),t.sending?e("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],1),e("b-modal",{attrs:{title:"ulkopuolinen asiakas"},on:{ok:t.saveExternalClient},model:{value:t.show_modal_external,callback:function(e){t.show_modal_external=e},expression:"show_modal_external"}},[e("b-form-group",{staticStyle:{"margin-top":"30px"}},[e("label",[t._v("sukunimi")]),e("b-input",{model:{value:t.external_client.sukunimi,callback:function(e){t.$set(t.external_client,"sukunimi",e)},expression:"external_client.sukunimi"}}),e("label",[t._v("etunnimi")]),e("b-input",{model:{value:t.external_client.etunimi,callback:function(e){t.$set(t.external_client,"etunimi",e)},expression:"external_client.etunimi"}}),e("label",[t._v("sähköposti (PAKOLLINEN)")]),e("b-input",{model:{value:t.external_client.sahkoposti,callback:function(e){t.$set(t.external_client,"sahkoposti",e)},expression:"external_client.sahkoposti"}}),e("label",[t._v("kortin numero")]),e("b-input",{model:{value:t.external_client.kirjastokortin_numero,callback:function(e){t.$set(t.external_client,"kirjastokortin_numero",e)},expression:"external_client.kirjastokortin_numero"}})],1),t.sending?e("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],1),e("b-modal",{attrs:{title:"liitä asiakas pyyntöön","cancel-title":"peru","ok-title":"liitä"},on:{ok:t.saveJoinClient},model:{value:t.show_modal_join_client,callback:function(e){t.show_modal_join_client=e},expression:"show_modal_join_client"}},[t.join_client?e("b-form-group",{staticStyle:{"margin-top":"30px"}},[e("label",[t._v("sukunimi")]),e("p",[e("b",[t._v(t._s(t.join_client.sukunimi))])]),e("label",[t._v("etunnimi")]),e("p",[e("b",[t._v(t._s(t.join_client.etunimi))])]),e("label",[t._v("kortin numero")]),e("p",[t._v(t._s(t.join_client.kirjastokortin_numero))]),e("label",[t._v("sähköposti(t)")]),e("p",[e("b",[t._v(t._s(t.join_client.sahkoposti.join(", ")))])]),e("label",[t._v("lisää sähköposti asiakkaalle (valinnainen)")]),e("b-input",{model:{value:t.add_sahkoposti,callback:function(e){t.add_sahkoposti=e},expression:"add_sahkoposti"}})],1):t._e(),t.sending?e("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],1)],1):e("div",{staticClass:"alert alert-info"},[t._v("lataan...")]),!t.ready||"arkistoitu"!=t.request.status&&"peruttu"!=t.request.status?t._e():e("img",{staticStyle:{position:"absolute",top:"120px",left:"0%"},attrs:{src:a("f931")}})])},n=[],s=a("3835"),r=a("b85c"),o=a("c7eb"),l=a("2909"),u=a("1da1"),c=(a("14d9"),a("4d90"),a("d3b7"),a("25f0"),a("caad"),a("2532"),a("6062"),a("3ca3"),a("ddb0"),a("bc3a")),d=a.n(c),_=function(){var t=this,e=t._self._c;return e("div",[e("b-form-group",[e("label",[t._v("valitse kirjasto")]),e("b-select",{attrs:{id:"lib_select",options:t.libraries,"value-field":"_id","text-field":"nimi"},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}),t.current?e("b-container",[e("h3",[t._v(t._s(t.current.nimi))]),e("b-card",[e("table",t._l(t.fields,(function(a){return e("tr",{key:a.key},[e("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(a.key))]),"lomake"==a.key||"kotisivut"==a.key?e("td",[e("a",{attrs:{target:"_blank",href:t.current[a.key]}},[t._v(t._s(t.current[a.key]))])]):e("td",[e("b",[t._v(t._s(t.current[a.key]))])])])})),0)]),t.current.lomake?t._e():e("div",[e("label",[t._v("saatepohjat")]),e("b-select",{attrs:{id:"saate_select",options:t.saatteet,"value-field":"_id","text-field":"_id"},model:{value:t.message_id,callback:function(e){t.message_id=e},expression:"message_id"}}),e("label",[t._v("saateviesti")]),e("b-form-textarea",{attrs:{id:"textarea",placeholder:"valitse saatepohja...",rows:"10"},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}})],1),t.current.lomake&&""!=t.current.lomake?e("div",[e("div",{staticClass:"alert alert-info"},[e("a",{attrs:{target:"_blank",href:t.current.lomake}},[t._v("tilauslomake")]),t._v(" (aukeaa uuteen ikkunaan)")]),e("br")]):t._e(),e("b-button",{staticClass:"float-right",staticStyle:{"margin-top":"20px"},attrs:{id:"send-order",variant:"primary"},on:{click:function(e){return t.sendOrder()}}},[t._v("lähetä tilaus")]),t.sending?e("div",{staticClass:"alert alert-info"},[t._v("Lähetetään...")]):t._e(),e("b-form-checkbox",{attrs:{id:"checkbox-2",name:"checkbox-2",value:"no","unchecked-value":"yes"},model:{value:t.send_email,callback:function(e){t.send_email=e},expression:"send_email"}},[t._v(" älä lähetä tilausta sähköpostitse ")])],1):t._e()],1),t.error?e("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e()],1)},h=[],p=(a("e9c4"),{name:"WEOrderForm",data:function(){return{libraries:[],message:"",message_id:null,info:"",selected:null,current:null,error:null,fields:[{key:"email",label:"sähköposti"},{key:"osoite"},{key:"kotisivut"}],saatteet:[],send_email:"yes",sending:!1}},props:["request"],watch:{selected:function(){this.getCurrent()},message_id:function(){var t,e=Object(r["a"])(this.saatteet);try{for(e.s();!(t=e.n()).done;){var a=t.value;if(a._id==this.message_id){this.message=a.saate;var i=this.getInfo("en"),n=this.getInfo("fi");this.message=this.message.replace("[[ID]]",this.request._id),this.request.tarvitaan_viimeistaan&&"undefined"!=this.request.tarvitaan_viimeistaan&&(this.message=this.message.replace("[[TARVITAAN_VIIMEISTAAN]]",this.request.tarvitaan_viimeistaan)),this.message=this.message.replace("[[EN]]",i),this.message=this.message.replace("[[FI]]",n)}}}catch(s){e.e(s)}finally{e.f()}}},methods:{getCurrent:function(){var t,e=Object(r["a"])(this.libraries);try{for(e.s();!(t=e.n()).done;){var a=t.value;a._id==this.selected&&(this.current=a,this.message=a.saate)}}catch(i){e.e(i)}finally{e.f()}},getInfo:function(t){var e={pyynto_id:{en:"ID",fi:"ID"},teoksen_tiedot:{en:"title",fi:"teos"}};return e["teoksen_tiedot"][t]+": "+this.request.teoksen_tiedot},sendOrder:function(){var t=this;return Object(u["a"])(Object(o["a"])().mark((function e(){var a,i,n;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.message){e.next=3;break}return alert("Saateviesti on pakollinen!"),e.abrupt("return");case 3:return t.sending=!0,a={kirjasto_id:t.current._id,kirjaston_nimi:t.current.nimi,viesti:t.message,info:t.info,message_id:t.message_id,send_mail:t.send_email},e.prev=5,e.next=8,fetch(t.$G.api_url+"/api/pyynnot/"+t.$route.params.id+"/tilaukset",{method:"POST",body:JSON.stringify(a)});case 8:return i=e.sent,e.next=11,i.json();case 11:if(n=e.sent,i.ok){e.next=16;break}throw"fail";case 16:t.sending=!1,t.$emit("exit",!0);case 18:e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](5),t.sending=!1,n&&n.error?alert(n.error):alert("virhe "+e.t0);case 24:case"end":return e.stop()}}),e,null,[[5,20]])})))()},loadMessages:function(){var t=this;fetch(this.$G.api_url+"/api/saatteet?_id=tilaussaate*").then((function(t){return t.json()})).then((function(e){t.saatteet=e,t.ready=!0})).catch((function(t){console.log("error"+t)}))},loadData:function(){var t=this;this.ready=!1,fetch(this.$G.api_url+"/api/kirjastot?sort=nimi").then((function(t){return t.json()})).then((function(e){t.libraries=e,t.loadMessages(),t.ready=!0})).catch((function(t){alert("error"+t)}))}},mounted:function(){this.loadData()}}),k=p,m=a("2877"),v=Object(m["a"])(k,_,h,!1,null,null,null),f=v.exports,b=a("5370"),y=a("96dd"),g={name:"WERequests",components:{WEOrderForm:f,DueDate:b["a"]},data:function(){return{request:null,client:null,client_query:"",title:"",join_client:null,add_sahkoposti:"",payer:null,payer_selected:null,payer_info:"",payer_is_client:"no",orders:[],clients_result:null,arrived_order:null,laheta_saapumisilmoitus:"yes",laheta_peruutusilmoitus:"yes",organisations:[],ready:!1,error:null,note:"",show:!1,sending:!1,show_modal_arrived:!1,show_modal_payer:!1,show_modal_loan_date:!1,show_modal_due_notice:!1,show_modal_external:!1,show_modal_note:!1,show_modal_title:!1,show_modal_cancel_request:!1,show_modal_cancel_archive:!1,show_modal_join_client:!1,cancel_reason:"",due_notice:"",new_loan_date:"",external_client:{},loan_library_name:"",primaryBG:"primary",primaryText:"white",tilaus_uusittavissa:"yes",tilaus_info:"",fields:[{key:"teoksen_tiedot"},{key:"tilaajan_nimi"},{key:"tilaajan_sahkoposti",label:"tilaajan sähköposti"},{key:"toiminto"}],order_fields:[{key:"kirjaston_nimi"},{key:"status",label:"status"},{key:"pvm",label:"tilaus tehty"},{key:"pvm_saapunut",label:"saapunut"},{key:"toiminto"}],client_fields:[{key:"sukunimi"},{key:"etunimi"},{key:"sahkoposti",label:"sähköposti"},{key:"valitse",label:"valitse"}]}},props:["status"],watch:{$route:function(t,e){this.$route.params.id?this.loadData():this.current=null}},methods:{openJoinClient:function(t){this.show_modal_join_client=!0,this.join_client=t},formatDate:function(t,e,a){a||(a=".");var i=[];if(t){var n=new Date(t);return n instanceof Date&&isFinite(n)?(i.push(n.getFullYear()),i.push((n.getMonth()+1).toString().padStart(2,"0")),i.push(n.getDate().toString().padStart(2,"0")),e?i.reverse().join(a):i.join(a)):t}return"-"},isExternal:function(){return!(!this.request.tilaajan_sahkoposti.includes("_external_")||this.request.tilaaja)},saveJoinClient:function(t){var e=this;return Object(u["a"])(Object(o["a"])().mark((function a(){var i,n,s,r;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t&&t.preventDefault(),i={tilaaja:e.join_client._id},n={},s=e.$G.api_url+"/api/pyynnot/"+e.$route.params.id,r=e.$G.api_url+"/api/asiakkaat/"+e.join_client._id,a.prev=5,a.next=8,d.a.put(s,i);case 8:return a.sent,e.add_sahkoposti.includes("@")&&(e.join_client.sahkoposti.push(e.add_sahkoposti),n.sahkoposti=Object(l["a"])(new Set(e.join_client.sahkoposti))),a.next=12,d.a.put(r,n);case 12:a.sent,e.loadData(),e.show_modal_join_client=!1,a.next=20;break;case 17:a.prev=17,a.t0=a["catch"](5),alert("Asiakkaan liittäminen tai sähköpostin lisäys ei onnistunut! "+a.t0);case 20:case"end":return a.stop()}}),a,null,[[5,17]])})))()},saveExternalClient:function(t){var e=this;return Object(u["a"])(Object(o["a"])().mark((function a(){var i,n,s,r,l,u,c;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.preventDefault(),e.external_client.sahkoposti&&e.external_client.sahkoposti.includes("@")&&""!=e.external_client.sahkoposti){a.next=4;break}return alert("Sähköposti on pakollinen tieto"),a.abrupt("return");case 4:return i=e.$G.api_url+"/api/asiakkaat?sahkoposti="+e.external_client.sahkoposti,a.prev=5,a.next=8,d.a.get(i);case 8:return n=a.sent,s={tilaajan_sahkoposti:e.external_client.sahkoposti},r=e.$G.api_url+"/api/pyynnot/"+e.$route.params.id,a.next=13,d.a.put(r,s);case 13:return a.sent,a.next=16,n.data;case 16:if(l=a.sent,0!=l.length){a.next=31;break}return a.prev=18,u=e.$G.api_url+"/api/asiakkaat/",a.next=22,d.a.post(u,e.external_client);case 22:return c=a.sent,e.join_client=c.data,a.next=26,e.saveJoinClient();case 26:a.next=31;break;case 28:a.prev=28,a.t0=a["catch"](18),alert(a.t0);case 31:e.show_modal_external=!1,e.loadData(),a.next=39;break;case 35:a.prev=35,a.t1=a["catch"](5),alert(a.t1),console.log(a.t1);case 39:case"end":return a.stop()}}),a,null,[[5,35],[18,28]])})))()},cancelPayer:function(){"asiakas"==this.request.maksaja&&(this.payer_is_client="yes")},setPayer:function(t){var e=this;return Object(u["a"])(Object(o["a"])().mark((function t(){var a,i;return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={maksaja_varmistettu:e.payer_selected,maksaja_info:e.payer_info,maksaja:"laitos"},"yes"==e.payer_is_client&&(a={maksaja_varmistettu:null,maksaja:"asiakas"}),t.prev=2,i=e.$G.api_url+"/api/pyynnot/"+e.$route.params.id,t.next=6,d.a.put(i,a);case 6:t.sent,e.loadData(),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](2),alert(t.t0);case 13:case"end":return t.stop()}}),t,null,[[2,10]])})))()},updateTitle:function(){var t=this;return Object(u["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y["a"].updateRequest(t.$route.params.id,{teoksen_tiedot:t.title});case 3:t.loadData(),e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),alert(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))()},setNonArchived:function(){var t=this,e=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id,a={status:"kasittelyssa"};d.a.put(e,a).then((function(e){t.loadData()})).catch((function(e){alert("Muutoksen tallettaminen epäonnistui "+t.getError(e,""))}))},openArrived:function(t){this.arrived_order=t,this.arrived_order.erapaiva=this.$G.getToday("reverse",1),this.show_modal_arrived=!0},openKarhuRequest:function(){var t=this;return Object(u["a"])(Object(o["a"])().mark((function e(){var a;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d()(t.$G.api_url+"/api/saatteet?_id=asiakas: karhu");case 3:a=e.sent,t.due_notice=a.data[0].saate,t.due_notice=t.due_notice.replace("[[FI]]",t.$G.getInfo(t.request,"fi")),t.due_notice=t.due_notice.replace("[[EN]]",t.$G.getInfo(t.request,"en")),t.due_notice=t.due_notice.replace("[[ERAPAIVA]]",t.formatDate(t.request.tilaus_saatu.pvm_erapaiva,"reverse",".")),t.due_notice=t.due_notice.replace("[[ERAPAIVA]]",t.formatDate(t.request.tilaus_saatu.pvm_erapaiva,"reverse",".")),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),alert("karhuviestipohjaa ei saatu");case 14:t.show_modal_due_notice=!0;case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))()},openCancelRequest:function(){var t=this;d.a.get(this.$G.api_url+"/api/saatteet?_id=asiakas: peruutusviesti").then((function(e){t.cancel_reason=e.data[0].saate,t.cancel_reason=t.cancel_reason.replace("[[FI]]",t.$G.getInfo(t.request,"fi")),t.cancel_reason=t.cancel_reason.replace("[[EN]]",t.$G.getInfo(t.request,"en"))})).catch((function(e){t.cancel_reason="peruutusviestipohjaa ei löytynyt!"})),this.show_modal_cancel_request=!0},convertToBook:function(){var t=this;return Object(u["a"])(Object(o["a"])().mark((function e(){var a,i;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:a={teos_on:"kirja"},i=t.$G.api_url+"/api/pyynnot/"+t.$route.params.id,d.a.put(i,a).then((function(e){t.loadData()})).catch((function(e){alert("Muunnoksen tallettaminen epäonnistui "+t.getError(e,""))}));case 3:case"end":return e.stop()}}),e)})))()},setNote:function(t){var e=this;t.preventDefault(),this.sending=!0;var a={huomautuksia:this.note},i=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id;d.a.put(i,a).then((function(t){e.sending=!1,e.show_modal_note=!1,e.loadData()})).catch((function(t){alert("Huomion tallettaminen epäonnistui"),e.error=t,e.sending=!1}))},setDueDate:function(){""==this.new_loan_date&&(this.new_loan_date=this.formatDate(this.request.tilaus_saatu.pvm_erapaiva,"reverse","."))},sendDueNotice:function(t){var e=this;return Object(u["a"])(Object(o["a"])().mark((function a(){var i,n,s;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.preventDefault(),e.sending=!0,i={notice:e.due_notice},n=e.$G.api_url+"/api/pyynnot/"+e.$route.params.id+"/karhu",a.prev=4,a.next=7,d.a.post(n,i);case 7:a.sent,e.sending=!1,e.show_modal_due_notice=!1,e.loadData(),a.next=19;break;case 13:a.prev=13,a.t0=a["catch"](4),e.sending=!1,s="",a.t0.response.data&&a.t0.response.data.error&&(s=a.t0.response.data.error),alert(s);case 19:case"end":return a.stop()}}),a,null,[[4,13]])})))()},setCancelled:function(){var t=this;this.sending=!0;var e={peruutuksen_syy:this.cancel_reason,laheta_peruutusilmoitus:this.laheta_peruutusilmoitus},a=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id+"/cancelled";d.a.put(a,e).then((function(e){t.sending=!1,t.loadData()})).catch((function(e){alert("peruutus epäonnistui"),t.sending=!1,t.error=e}))},setLoanDate:function(t){var e=this;this.sending=!0,t.preventDefault();var a={due_date:this.new_loan_date.split(".").reverse().join("-"),info:this.tilaus_info,uusittavissa:this.tilaus_uusittavissa},i=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id+"/due_date";d.a.put(i,a).then((function(t){e.sending=!1,e.show_modal_loan_date=!1,e.loadData()})).catch((function(t){e.sending=!1,alert(e.getError(t,"eräpäivän asettaminen epäonnistui"))}))},setReturned:function(){var t=this;this.sending=!0;var e={pvm_palautettu:this.$G.getToday(),status:"palautettu"},a=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id+"/returned";d.a.put(a,e).then((function(e){t.sending=!1,t.loadData()})).catch((function(e){t.sending=!1,alert(t.getError(e,"Arkistointi epäonnistui"))}))},setNotAvailable:function(t){var e=this;this.sending=!1;var a=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id+"/tilaukset/"+t+"/not_available";d.a.put(a,{}).then((function(t){e.sending=!1,e.loadData()})).catch((function(t){e.sending=!1,alert(e.getError(t,"Pyyntö epäonnistui"))}))},setArrived:function(t){var e=this;t.preventDefault(),this.sending=!1;var a={erapaiva:this.arrived_order.erapaiva.split(".").reverse().join("-"),maksu:this.arrived_order.maksu,laheta_saapumisilmoitus:this.laheta_saapumisilmoitus},i=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id+"/tilaukset/"+this.arrived_order._id+"/arrived";d.a.put(i,a).then((function(t){e.sending=!1,e.show_modal_arrived=!1,e.loadData()})).catch((function(t){e.sending=!1,alert(e.getError(t,"Pyyntö epäonnistui"))}))},checkDate:function(t){var e=t.split(".");if(3!==e.length)return!1},reserve:function(t){var e=this;return Object(u["a"])(Object(o["a"])().mark((function a(){var i,n,s,r;return Object(o["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=e.$G.api_url+"/api/pyynnot/"+t,a.next=3,d.a.get(i);case 3:if(n=a.sent,s=n.data,!s||""!=s["status"]&&"uusi"!=s["status"]){a.next=10;break}return r={status:"kasittelyssa",kasittelija:e.$G.user},a.next=9,d.a.put(i,r);case 9:a.sent;case 10:case"end":return a.stop()}}),a)})))()},setLoanLibrary:function(){var t,e=Object(r["a"])(this.orders);try{for(e.s();!(t=e.n()).done;){var a=t.value;a.pvm_saapunut&&(this.loan_library_name=a.kirjaston_nimi)}}catch(i){e.e(i)}finally{e.f()}},searchClients:function(){var t=this;return Object(u["a"])(Object(o["a"])().mark((function e(){var a,i;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.$G.api_url+"/api",e.next=3,d.a.get(a+"/asiakkaat/?search="+t.client_query);case 3:i=e.sent,t.clients_result=i.data;case 5:case"end":return e.stop()}}),e)})))()},loadData:function(){var t=this;return Object(u["a"])(Object(o["a"])().mark((function e(){var a,i,n,r,l;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.show=!1,t.error=null,t.arrived_order=null,t.ready=!1,t.payer_selected=null,t.payer_is_client="no",e.prev=6,a=t.$G.api_url+"/api",e.next=10,Promise.all([d.a.get(a+"/pyynnot/"+t.$route.params.id),d.a.get(a+"/organisaatiot")]);case 10:i=e.sent,n=Object(s["a"])(i,2),r=n[0],l=n[1],t.request=r.data,t.request.tilaus_saatu&&(t.tilaus_uusittavissa=t.request.tilaus_saatu.uusittavissa,t.tilaus_info=t.request.tilaus_saatu.info),t.request.tilaajan_sahkoposti||(t.request.tilaajan_sahkoposti="VIRHEELLINEN TILAAJA"),t.title=t.request.teoksen_tiedot,t.orders=t.request.tilaukset,t.note=t.request.huomautuksia,t.organisations=l.data,t.request.maksaja_varmistettu&&t.request.maksaja_varmistettu._id&&(t.payer_selected=t.request.maksaja_varmistettu._id),"asiakas"===t.request.maksaja&&(t.payer_is_client="yes"),t.setLoanLibrary(),t.request.tilaajan_sahkoposti.includes("_external_")&&(t.external_client.sukunimi=t.request.sukunimi,t.external_client.etunimi=t.request.etunimi,t.external_client.kirjastokortin_numero=t.request.kirjastokortin_numero,t.client_query=t.request.sukunimi,t.searchClients()),t.ready=!0,"uusi"===t.request.status&&t.reserve(t.request._id),e.next=34;break;case 29:e.prev=29,e.t0=e["catch"](6),alert(e.t0),t.error="virhe",t.ready=!0;case 34:case"end":return e.stop()}}),e,null,[[6,29]])})))()},getError:function(t,e){return t.response&&t.response.data&&t.response.data.error?t.response.data.error:e}},mounted:function(){this.loadData()}},j=g,x=(a("772b"),Object(m["a"])(j,i,n,!1,null,"73c88aa6",null));e["a"]=x.exports},e347:function(t,e,a){t.exports=a.p+"img/logo.cf45db45.svg"},f392:function(t,e,a){"use strict";a("ac1f"),a("841c"),a("a15b");var i=function(){var t=this,e=t._self._c;return e("b-container",{attrs:{fluid:""}},[e("h1",[t._v("Asiakkaat")]),t.ready?t._e():e("div",{staticClass:"alert alert-info"},[t._v("lataan...")]),t.current_client?t._e():e("b-card",{attrs:{title:"haku"}},[e("b-row",{staticClass:"my-1"},[e("b-col",{attrs:{sm:"4"}},[e("b-form-input",{attrs:{id:"input-default",placeholder:"hae sukunimellä tai sähköpostilla"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.search_term,callback:function(e){t.search_term=e},expression:"search_term"}}),e("b-button",{on:{click:t.search}},[t._v("hae")])],1)],1)],1),0===t.search_result.length||t.current_client?t._e():e("div",[e("b-table",{attrs:{items:t.search_result,fields:t.fields},scopedSlots:t._u([{key:"cell(sahkoposti)",fn:function(a){return[e("b",{staticClass:"text-info"},[t._v(t._s(a.value.join(", ")))])]}},{key:"cell(sukunimi)",fn:function(a){return[e("b-link",{attrs:{to:"/asiakkaat/"+a.item._id}},[t._v(t._s(a.value))])]}}],null,!1,1301209900)})],1),t.current_client?e("div",[t.edit?t._e():e("b-card",{attrs:{title:t.current_client.sukunimi+", "+t.current_client.etunimi,"header-bg-variant":"dark"}},[e("table",t._l(t.fields,(function(a){return e("tr",{key:a.key},[e("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(a.label))]),"sahkoposti"==a.key?e("td",{staticStyle:{"min-width":"350px"}},t._l(t.current_client.sahkoposti,(function(a){return e("div",{key:a},[e("a",{attrs:{href:"mailto:"+a}},[t._v(t._s(a))])])})),0):e("td",[e("b",[t._v(t._s(t.current_client[a.key]))])])])})),0),t.edit?t._e():e("b-icon",{staticClass:"float-right pointer",attrs:{icon:"pen",variant:"primary"},on:{click:function(e){t.edit=!t.edit}}},[t._v("muokkaa")])],1),t.edit?e("b-card",{attrs:{title:t.current_client.sukunimi,"header-bg-variant":"dark"}},[e("table",{staticClass:"table table-striped"},t._l(t.fields,(function(a){return e("tr",{key:a.key},[e("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(a.label))]),"sahkoposti"==a.key?e("td",{staticStyle:{"min-width":"350px"}},[t.current_client[a.key]&&t.current_client[a.key][0]?e("b-form-input",{model:{value:t.current_client[a.key][0],callback:function(e){t.$set(t.current_client[a.key],0,e)},expression:"current_client[field.key][0]"}}):t._e(),t.current_client[a.key]?e("b-form-input",{model:{value:t.current_client[a.key][1],callback:function(e){t.$set(t.current_client[a.key],1,e)},expression:"current_client[field.key][1]"}}):t._e()],1):"ulkopuolinen"==a.key?e("td",[e("b-form-checkbox",{attrs:{id:"checkbox-1",name:"checkbox-1"},model:{value:t.current_client.ulkopuolinen,callback:function(e){t.$set(t.current_client,"ulkopuolinen",e)},expression:"current_client.ulkopuolinen"}})],1):e("td",{staticStyle:{"min-width":"350px"}},[e("b-form-input",{model:{value:t.current_client[a.key],callback:function(e){t.$set(t.current_client,a.key,e)},expression:"current_client[field.key]"}})],1)])})),0),e("b-container",[e("b-button",{staticClass:"float-right",staticStyle:{"margin-left":"20px"},attrs:{variant:"primary"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")]),e("b-button",{staticClass:"float-right",on:{click:function(e){t.edit=!t.edit}}},[t._v("peru")])],1)],1):t._e(),e("b-link",{attrs:{to:"/asiakkaat"}},[t._v("takaisin hakuun")]),e("h2",{staticStyle:{"margin-top":"40px"}},[t._v(t._s(t.laina_title))]),e("b-form-checkbox",{attrs:{id:"checkbox-1",name:"show-all-requests"},model:{value:t.show_all_requests,callback:function(e){t.show_all_requests=e},expression:"show_all_requests"}},[t._v(" näytä kaikki pyynnöt ")]),e("b-table",{attrs:{items:t.requests,fields:t.request_fields},scopedSlots:t._u([{key:"cell(tiedot)",fn:function(a){return[e("div",{staticStyle:{"min-width":"250px"}},[e("b-link",{attrs:{to:"/pyynnot/"+a.item._id}},[t._v(t._s(a.item.teoksen_tiedot))])],1)]}},{key:"cell(kirjasto)",fn:function(a){return[a.item.tilaus_saatu?e("b-link",{attrs:{to:"/kirjastot/"+a.item.tilaus_saatu.kirjasto_id}},[t._v(t._s(a.item.tilaus_saatu.kirjaston_nimi))]):t._e()]}},{key:"cell(tilaus_saatu.pvm_erapaiva)",fn:function(t){return[e("DueDate",{attrs:{item:t.item}})]}},{key:"cell(_id)",fn:function(e){return[t._v(" "+t._s(e.value)+" ")]}}],null,!1,2355413550)})],1):t._e()],1)},n=[],s=a("c7eb"),r=a("1da1"),o=a("b85c"),l=(a("caad"),a("2532"),a("5319"),a("4de4"),a("d3b7"),a("e9c4"),a("14d9"),a("5370")),u={name:"WEClient",components:{DueDate:l["a"]},data:function(){return{search_term:"",search_result:[],requests:[],all_requests:[],show_all_requests:!1,current_client:null,ready:!0,edit:!1,laina_title:"lainassa olevat kaukolainat",laina_button_title:"näytä kaikki kaukolainapyynnöt",fields:[{key:"sukunimi",label:"sukunimi"},{key:"etunimi",label:"etunimi"},{key:"sahkoposti",label:"sähköposti"},{key:"kirjastokortin_numero",label:"kirjastokortti"},{key:"puhelin",label:"puhelin"},{key:"osoite",label:"osoite"},{key:"huomio",label:"lisätieto"},{key:"ulkopuolinen",label:"ulkopuolinen asiakas"}],request_fields:[{key:"_id",label:"tunniste"},{key:"teos_on",label:"tyyppi"},{key:"tiedot"},{key:"kirjasto",label:"kirjasto"},{key:"maksu",label:"maksu"},{key:"maksaja",label:"maksaja"},{key:"status"},{key:"tilaus_saatu.pvm_erapaiva",label:"eräpäivä"}]}},watch:{show_all_requests:function(){this.showAllRequests()},$route:function(t,e){t.path.includes("/asiakkaat")&&(this.$route.params.id?this.loadData():e.path.includes("/asiakkaat")?this.current_client=null:this.current_client&&this.$router.replace({path:"/asiakkaat/"+this.current_client._id}))}},methods:{saveForm:function(){var t=this;delete this.current_client._id,this.current_client.sahkoposti=this.current_client.sahkoposti.filter((function(t){return""!=t})),fetch(this.$G.api_url+"/api/asiakkaat/"+this.$route.params.id,{method:"PUT",body:JSON.stringify(this.current_client)}).then((function(t){return t.json()})).then((function(e){t.loadData()})).catch((function(t){alert("Talletus ei onnistunut"+t),console.log("error"+t)}))},loadData:function(){var t=this;this.$route.params.id&&(this.ready=!1,this.edit=!1,this.current_client=null,fetch(this.$G.api_url+"/api/asiakkaat/"+this.$route.params.id).then((function(t){return t.json()})).then((function(e){t.current_client=e,t.loadRelated()})).catch((function(t){console.log("error"+t)})))},showAllRequests:function(){this.show_all_requests?(this.requests=this.all_requests,this.laina_title="kaikki kaukolainapyynnöt",this.laina_button_title="näytä vain lainassa olevat"):(this.requests=this.sortByStatus(this.all_requests),this.laina_title="lainassa olevat kaukolainat",this.laina_button_title="näytä kaikki kaukalainapyynnöt")},sortByStatus:function(t){var e,a=[],i=Object(o["a"])(t);try{for(i.s();!(e=i.n()).done;){var n=e.value;"lainassa"===n.status&&a.push(n)}}catch(s){i.e(s)}finally{i.f()}return a},loadRelated:function(){var t=this;fetch(this.$G.api_url+"/api/pyynnot/?sort=tilaus_saatu.pvm_erapaiva&reverse=1&tilaaja="+this.current_client._id).then((function(t){return t.json()})).then((function(e){t.all_requests=e,t.requests=t.sortByStatus(e),t.ready=!0})).catch((function(t){console.log("error"+t)}))},search:function(){var t=this;return Object(r["a"])(Object(s["a"])().mark((function e(){var a,i;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.current_client=null,""===t.search_term){e.next=9;break}return a="search="+t.search_term,e.next=5,fetch(t.$G.api_url+"/api/asiakkaat?"+a);case 5:return i=e.sent,e.next=8,i.json();case 8:t.search_result=e.sent;case 9:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.loadData()}},c=u,d=a("2877"),_=Object(d["a"])(c,i,n,!1,null,null,null);e["a"]=_.exports},f931:function(t,e,a){t.exports=a.p+"img/arkistoitu_vino.c22fb25a.png"}});
//# sourceMappingURL=app.c8b032d8.js.map