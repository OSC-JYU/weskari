(function(t){function e(e){for(var i,s,o=e[0],l=e[1],u=e[2],d=0,_=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&_.push(n[s][0]),n[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);c&&c(e);while(_.length)_.shift()();return r.push.apply(r,u||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],i=!0,o=1;o<a.length;o++){var l=a[o];0!==n[l]&&(i=!1)}i&&(r.splice(e--,1),t=s(s.s=a[0]))}return t}var i={},n={app:0},r=[];function s(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=i,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var u=0;u<o.length;u++)e(o[u]);var c=l;r.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";a("85ec")},"3dfd":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("div",[i("b-navbar",{staticClass:"nav-weskari",attrs:{toggleable:"lg",type:"dark"}},[i("img",{staticClass:"mr-3",attrs:{src:a("e347"),height:"40px"}}),i("b-navbar-brand",{staticClass:"brand",attrs:{to:{path:"/"}}},[t._v("WESKARI ")]),i("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),i("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[i("b-navbar-nav",[i("b-nav-item",{attrs:{to:"/lainat"}},[t._v("Lainat")]),i("b-nav-item",{attrs:{to:"/asiakkaat"}},[t._v("Asiakkaat")]),i("b-nav-item",{attrs:{to:"/kirjastot"}},[t._v("Kirjastot")]),i("b-nav-item",{attrs:{to:"/organisaatiot"}},[t._v("Organisaatiot")]),i("b-nav-item",{attrs:{to:"/saatteet"}},[t._v("Saatteet")]),i("b-nav-item",{attrs:{to:"/tilastot"}},[t._v("Tilastot")])],1),i("b-navbar-nav",{staticClass:"ml-auto"},[i("b-nav-item-dropdown",{attrs:{right:""},scopedSlots:t._u([{key:"button-content",fn:function(){return[i("em",[t._v(t._s(t.$G.user))])]},proxy:!0}])},[i("b-dropdown-item",{attrs:{href:"/Shibboleth.sso/Logout"}},[t._v("kirjaudu ulos")])],1)],1)],1)],1)],1),t.$G.login?i("b-container",{attrs:{fluid:""}},[i("keep-alive",{attrs:{include:"WELoans,WELibrary,WEClient"}},[t.error?t._e():i("router-view",{staticClass:"view"})],1),t.error?i("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e()],1):t._e()],1)},n=[],r=(a("d3b7"),{name:"app",data:function(){return{error:null,user:null,logging:!1,intervalID:null}},methods:{login:function(){var t=this;console.log("trying login..."),fetch(this.$G.api_url+"/api/auth",{credentials:"include"}).then((function(t){if(!t.ok)throw{msg:"session terminated"};return t})).then((function(t){return t.json()})).then((function(e){t.$G.user=e.shibboleth.user})).catch((function(e){console.log(e),e.msg&&"session terminated"==e.msg?t.error="Kirjautuminen vanheni. Lataa sivu uudestaan.":t.error="Kirjautuminen epäonnistui. Kirjautuminen luultavasti vanheni, lataa sivu uudestaan.",t.$G.user=""}))}},watch:{$route:{immediate:!0,handler:function(t,e){document.title=t.meta.title||"WESKARI"}}},created:function(){var t=this;document.title="WESKARI",console.log(window.location.hostname),"localhost"==window.location.hostname&&(this.$G.api_url=""),this.login(),this.intervalID=setInterval((function(){return t.login()}),3e4)},beforeDestroy:function(){clearInterval(this.intervalID)}}),s=r,o=(a("034f"),a("2877")),l=Object(o["a"])(s,i,n,!1,null,null,null);e["a"]=l.exports},5370:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.item.tilaus_saatu?a("div",{staticStyle:{"min-width":"250px"}},[t.$G.isOverdue(t.item.tilaus_saatu.pvm_erapaiva)?a("div",{staticClass:"text-danger"},[a("b",[t._v(t._s(t.$G.formatDate(t.item.tilaus_saatu.pvm_erapaiva,"reverse",".")))])]):a("div",{staticClass:"text-info "},[t._v(t._s(t.$G.formatDate(t.item.tilaus_saatu.pvm_erapaiva,"reverse",".")))]),"no"==t.item.tilaus_saatu.uusittavissa?a("span",{staticClass:"text-danger",staticStyle:{"margin-left":"10px",padding:"0px"}},[t._v("ei voi uusia")]):t._e(),t.item.tilaus_saatu.info&&"undefined"!=t.item.tilaus_saatu.info?a("div",[t._v(t._s(t.item.tilaus_saatu.info))]):t._e()]):a("div",[t._v("-")])},n=[],r={name:"WEDueDateDisplay",props:["item"]},s=r,o=a("2877"),l=Object(o["a"])(s,i,n,!1,null,null,null);e["a"]=l.exports},"56d7":function(t,e,a){"use strict";a.r(e),function(t){a("e260"),a("e6cf"),a("cca6"),a("a79d"),a("4d90"),a("d3b7"),a("25f0"),a("a15b9"),a("fb6a"),a("ac1f"),a("1276");var e=a("2b0e"),i=a("8c4f"),n=a("5f5b"),r=a("b1e0"),s=a("ae77"),o=a("df45"),l=a("bb25"),u=a("f392"),c=a("ccd2"),d=a("a15b"),_=a("b4ac"),h=a("9e54"),p=(a("f9e3"),a("2dd8"),a("3dfd"));e["default"].use(n["a"]),e["default"].use(r["a"]),e["default"].use(i["a"]);var m=new i["a"]({base:t,routes:[{path:"/",component:s["a"]},{path:"/pyynnot/:id",component:o["a"]},{path:"/organisaatiot",component:l["a"]},{path:"/organisaatiot/:id",component:l["a"]},{path:"/asiakkaat",component:u["a"]},{path:"/asiakkaat/:id",component:u["a"]},{path:"/kirjastot",component:c["a"]},{path:"/kirjastot/:id",component:c["a"]},{path:"/saatteet",component:d["a"]},{path:"/saatteet/:id",component:d["a"]},{path:"/lainat",component:_["a"]},{path:"/tilastot",component:h["a"]}]});e["default"].config.productionTip=!1;var k=new e["default"]({data:{api_url:"/",login:!0,error:null,user:null},methods:{getStatus:function(t){return"kasittelyssa"==t?"käsittelyssä":t},isOverdue:function(t){var e=new Date(t),a=new Date;return e.getTime()<a.getTime()},formatDate:function(t,e,a){a||(a=".");var i=[];if(t){var n=new Date(t);return n instanceof Date&&isFinite(n)?(i.push(n.getFullYear()),i.push((n.getMonth()+1).toString().padStart(2,"0")),i.push(n.getDate().toString().padStart(2,"0")),e?i.reverse().join(a):i.join(a)):t}return"-"},getDateFromUUID:function(t){var e=new Date(1e3*parseInt(t.substring(0,8),16)),a=new Intl.DateTimeFormat("fi-FI").format(e);return a},getToday:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".",i=new Date;return e&&i.setMonth(i.getMonth()+e),t?("0"+i.getDate()).slice(-2)+a+("0"+(i.getMonth()+1)).slice(-2)+a+i.getFullYear():i.getFullYear()+a+("0"+(i.getMonth()+1)).slice(-2)+a+("0"+i.getDate()).slice(-2)},renderBreaks:function(t,e){return t&&"string"===typeof t?t.split(e).join("<br>"):""},getInfo:function(t,e){var a={pyynto_id:{en:"ID",fi:"ID"},teoksen_tiedot:{en:"title",fi:"teos"},sivut:{en:"pages",fi:"sivut"},julkaisun_tiedot:{en:"publication",fi:"julkaisu"}};return a["teoksen_tiedot"][e]+": "+t.teoksen_tiedot}},computed:{local:function(){return"localhost"==window.location.hostname?"":this.api_url}}});k.install=function(){Object.defineProperty(e["default"].prototype,"$G",{get:function(){return k}})},e["default"].use(k),new e["default"]({router:m,render:function(t){return t(p["a"])}}).$mount("#app")}.call(this,"/")},"7ef7":function(t,e,a){"use strict";a("c60a")},"82fd":function(t,e,a){},"85ec":function(t,e,a){},"96dd":function(t,e,a){"use strict";var i=a("1da1"),n=(a("96cf"),a("bc3a")),r=a.n(n),s={},o="";function l(t,e){return t.response&&t.response.data&&t.response.data.error?t.response.data.error:e}s.updateRequest=function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,a){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=o+"/api/pyynnot/"+e,r.a.put(i,a).catch((function(t){throw l(t,"Pyyntö epäonnistui")}));case 2:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),s.getLoanCount=Object(i["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=o+"/api/pyynnot/loan_count",t.abrupt("return",r.a.get(e));case 2:case"end":return t.stop()}}),t)}))),e["a"]=s},"9e54":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",[a("h1",[t._v("Tilastot")]),a("div",{staticStyle:{"margin-top":"20px","margin-bottom":"20px"}},[a("b-link",{attrs:{href:"#"},on:{click:function(e){return t.search(t.year)}}},[t._v(t._s(t.year)+" ")]),t._v(" | "),a("b-link",{on:{click:function(e){return t.search(t.year-1)}}},[t._v(t._s(t.year-1)+" | ")]),a("b-link",{on:{click:function(e){return t.search(t.year-2)}}},[t._v(t._s(t.year-2))])],1),a("b-card",{attrs:{title:t.current_year}},[a("b-row",{staticClass:"my-1"},[a("b-col",{attrs:{sm:"12"}},[a("b-table",{attrs:{striped:"",items:t.stats,fields:t.fields}})],1)],1)],1)],1)},n=[],r=(a("d3b7"),a("ac1f"),a("841c"),{name:"WEStatistics",data:function(){return{year:0,current_year:0,stats:[],libs:{},fields:[{key:"count",label:"lainat"},{key:"kirjaston_nimi",label:"kirjasto"}]}},methods:{search:function(t){var e=this;this.current_year=t,this.error=null,fetch(this.$G.api_url+"/api/tilastot/"+t).then((function(t){if(!t.ok)throw t.status;return t.json()})).then((function(t){e.stats=t})).catch((function(t){console.log("error"+t),e.error="virhe: "+t}))}},mounted:function(){this.year=(new Date).getFullYear(),this.current_year=this.year,this.search((new Date).getFullYear())}}),s=r,o=a("2877"),l=Object(o["a"])(s,i,n,!1,null,null,null);e["a"]=l.exports},a15b:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",{attrs:{fluid:""}},[a("h1",[t._v("Saatteet")]),t.ready&&0!==t.search_result.length&&!t.current&&""==t.mode?a("div",[a("b-table",{attrs:{items:t.search_result,fields:t.fields},scopedSlots:t._u([{key:"cell(_id)",fn:function(e){return[a("b-link",{attrs:{to:"/saatteet/"+e.item._id}},[t._v(t._s(e.value))])]}}],null,!1,1829266232)})],1):t._e(),t.ready&&t.current?a("b-card",{attrs:{title:t.current._id,"header-bg-variant":"dark"}},[a("div",{staticStyle:{"max-width":"700px"},domProps:{innerHTML:t._s(t.$G.renderBreaks(t.current.saate,"\n"))}}),a("br"),a("br"),"edit"!=t.mode?a("b-button",{on:{click:function(e){t.mode="edit"}}},[t._v("muokkaa")]):t._e()],1):t._e(),t.current&&"edit"==t.mode?a("b-card",{attrs:{title:t.current._id,"header-bg-variant":"dark"}},["edit"==t.mode?a("table",[a("tr",[a("td",{staticStyle:{"min-width":"200px"}},[t._v("saate")]),a("td",[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.current["saate"],expression:"current['saate']"}],attrs:{cols:"80",rows:"16"},domProps:{value:t.current["saate"]},on:{input:function(e){e.target.composing||t.$set(t.current,"saate",e.target.value)}}})])])]):t._e(),a("b-container",[a("b-button",{on:{click:function(e){return t.loadData()}}},[t._v("peru")]),a("b-button",{attrs:{variant:"info"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")])],1)],1):t._e(),a("div",{staticClass:"alert alert-info"},[t._v("Näillä placeholdereilla voit määrittää mihin mikin tieto tulee saatteessa. "),a("ul",[a("li",[t._v("[[ID]] = pyynnön tunniste")]),a("li",[t._v("[[FI]] = teoksen tiedot suomeksi ")]),a("li",[t._v("[[EN]] = teoksen tiedot englanniksi ")]),a("li",[t._v("[[ERAPAIVA]] = eräpäivä (saapumisilmoituksessa) ")]),a("li",[t._v("[[TARVITAAN_VIIMEISTAAN]] = tarvitaan viimeistään (tilauksessa) ")])])]),t.current?a("b-link",{attrs:{to:"/saatteet"}},[t._v("takaisin")]):t._e(),"add_new"==t.mode?a("b-card",{attrs:{title:"uusi saate","header-bg-variant":"dark"}},[a("table",t._l(t.fields,(function(e){return a("tr",{key:e.key},[a("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(e.key))]),a("td",[a("b-form-input",{model:{value:t.new_obj[e.key],callback:function(a){t.$set(t.new_obj,e.key,a)},expression:"new_obj[field.key]"}})],1)])})),0),a("b-button",{on:{click:function(e){t.mode=""}}},[t._v("peru")]),a("b-button",{attrs:{variant:"info"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")])],1):t._e()],1)},n=[],r=(a("d3b7"),a("e9c4"),{name:"WEMessage",data:function(){return{search_result:[],current:null,ready:!1,mode:"",new_obj:{},fields:[{key:"_id"},{key:"saate"}]}},watch:{$route:function(t,e){this.$route.params.id||(this.current=null),this.loadData()}},methods:{saveForm:function(){var t=this;"add_new"==this.mode?fetch(this.$G.api_url+"/api/saatteet",{method:"POST",body:JSON.stringify(this.new_obj)}).then((function(t){return t.json()})).then((function(e){t.$router.push("/saatteet/"+e._id)})).catch((function(t){console.log("error"+t)})):"edit"==this.mode&&(console.log("edit"),delete this.current._id,console.log(this.current),fetch(this.$G.api_url+"/api/saatteet/"+this.$route.params.id,{method:"PUT",body:JSON.stringify(this.current)}).then((function(t){return t.json()})).then((function(e){t.loadData()})).catch((function(t){console.log("error"+t)})))},editForm:function(){console.log(this.edit),console.log("sdf"),this.edit=!this.edit},loadData:function(){var t=this;this.$route.params.id?(this.mode="",this.ready=!1,this.current=null,fetch(this.$G.api_url+"/api/saatteet/"+this.$route.params.id).then((function(t){return t.json()})).then((function(e){t.current=e,t.ready=!0})).catch((function(t){console.log("error"+t)}))):fetch(this.$G.api_url+"/api/saatteet?sort=_id").then((function(t){return t.json()})).then((function(e){t.search_result=e,t.ready=!0})).catch((function(t){console.log("error"+t)}))}},mounted:function(){this.loadData()}}),s=r,o=a("2877"),l=Object(o["a"])(s,i,n,!1,null,null,null);e["a"]=l.exports},ae77:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-col",[a("div",[a("WERequests")],1),a("div",[a("hr",{staticClass:"my-4"}),a("p",[t._v("by OSC/vepa")])])])},n=[],r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",{attrs:{fluid:""}},[a("h1",[t._v("Pyynnöt")]),t.error?a("div",{staticClass:"alert- alert-danger"},[t._v(t._s(t.error))]):t._e(),a("div",[a("h4",[t._v("uudet")]),t.ready["uusi"]?[a("b-table",{attrs:{small:"",striped:"",hover:"",items:t.new_requests,fields:t.fields},scopedSlots:t._u([{key:"cell(tiedot)",fn:function(e){return[a("b-link",{attrs:{to:{path:"/pyynnot/"+e.item._id}}},[t._v(t._s(e.item.teoksen_tiedot))])]}},{key:"cell(tilaaja)",fn:function(e){return[e.item.tilaaja?a("b-link",{attrs:{to:{path:"/asiakkaat/"+e.item.tilaaja._id}}},[t._v(t._s(e.item.tilaaja.sukunimi+", "+e.item.tilaaja.etunimi))]):a("div",[t._v(t._s(e.item.sukunimi)+", "+t._s(e.item.etunimi)+" ulkopuolinen")])]}},{key:"cell(sahkoposti)",fn:function(e){return[e.item.tilaaja?a("div",[t._v(t._s(e.item.tilaaja.sahkoposti.join(", ")))]):a("div",{staticClass:"alert alert-warning"},[t._v("ulkopuolinen")])]}}],null,!1,3739004769)})]:a("div",{staticClass:"alert alert-info"},[t._v("ei uusia pyyntöjä")])],2),a("h4",[t._v("käsittelyssä")]),t.ready["kasittelyssa"]?[a("b-table",{attrs:{small:"",striped:"",hover:"",items:t.reserved_requests,fields:t.fields},scopedSlots:t._u([{key:"cell(tiedot)",fn:function(e){return[a("b-link",{attrs:{to:{path:"/pyynnot/"+e.item._id}}},[t._v(t._s(e.item.teoksen_tiedot))])]}},{key:"cell(tilaaja)",fn:function(e){return[e.item.tilaaja?a("b-link",{attrs:{to:{path:"/asiakkaat/"+e.item.tilaaja._id}}},[t._v(t._s(e.item.tilaaja.sukunimi+", "+e.item.tilaaja.etunimi))]):a("div",[t._v(t._s(e.item.sukunimi)+", "+t._s(e.item.etunimi)+" ulkopuolinen")])]}},{key:"cell(sahkoposti)",fn:function(e){return[e.item.tilaaja?a("div",[t._v(t._s(e.item.tilaaja.sahkoposti.join(", ")))]):a("div",{staticClass:"alert alert-warning"},[t._v("ulkopuolinen")])]}}],null,!1,3739004769)})]:a("div",{staticClass:"alert alert-info"},[t._v("ei käsittelyssä olevia pyyntöjä")]),a("h4",[t._v("tilattu")]),t.ready["tilattu"]?[a("b-table",{attrs:{small:"",striped:"",hover:"",items:t.ordered_requests,fields:t.fields},scopedSlots:t._u([{key:"cell(tiedot)",fn:function(e){return[a("b-link",{attrs:{to:{path:"/pyynnot/"+e.item._id}}},[t._v(t._s(e.item.teoksen_tiedot))])]}},{key:"cell(tilaaja)",fn:function(e){return[e.item.tilaaja?a("b-link",{attrs:{to:{path:"/asiakkaat/"+e.item.tilaaja._id}}},[t._v(t._s(e.item.tilaaja.sukunimi+", "+e.item.tilaaja.etunimi))]):t._e()]}},{key:"cell(sahkoposti)",fn:function(e){return[e.item.tilaaja?a("div",[t._v(t._s(e.item.tilaaja.sahkoposti.join(", ")))]):t._e()]}}],null,!1,2542628187)})]:a("div",{staticClass:"alert alert-info"},[t._v("ei saapumattomia tilauksia")])],2)},s=[],o=a("bc3a"),l=a.n(o),u={name:"WERequests",data:function(){return{new_requests:[],reserved_requests:[],ordered_requests:[],current:null,ready:{tilattu:!1,kasittelyssa:!1,uusi:!1},reserved_ready:!1,error:null,fields:[{key:"_id",label:"ID",thStyle:"width:10em"},{key:"teos_on",label:"tyyppi",thStyle:"width:6em"},{key:"tiedot",thStyle:"min-width:50%"},{key:"maksaja",label:"maksaja"},{key:"tilaaja",label:"asiakas"},{key:"kasittelija",label:"käsittelijä"}]}},props:["status"],watch:{current:function(){this.$G.current_request=this.current}},methods:{loadData:function(t,e,a){var i=this;l.a.get(this.$G.api_url+"/api/pyynnot?status="+t+a).then((function(a){i[e]=a.data,i[e].length?i.ready[t]=!0:i.ready[t]=!1})).catch((function(t){console.log("error"+t.response),i.error="virhe: "+t.response.data.error}))}},mounted:function(){this.loadData("uusi","new_requests",""),this.loadData("kasittelyssa","reserved_requests",""),this.loadData("tilattu","ordered_requests","")}},c=u,d=(a("7ef7"),a("2877")),_=Object(d["a"])(c,r,s,!1,null,"2205b044",null),h=_.exports,p={name:"WEMain",components:{WERequests:h},data:function(){return{requests:{}}},methods:{},mounted:function(){}},m=p,k=Object(d["a"])(m,i,n,!1,null,null,null);e["a"]=k.exports},b4ac:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",{attrs:{fluid:""}},[a("h1",[t._v("Lainat")]),a("div",{staticClass:"alert alert-info"},[t._v("lainassa tällä hetkellä: "),a("b",[t._v(t._s(t.loan_count))])]),a("div",[a("b-tabs",{attrs:{"content-class":"mt-3"},on:{"activate-tab":function(e){return t.getOverdueLoans()}}},[a("b-tab",{attrs:{title:"lainahaku",active:""}},[a("b-row",{staticClass:"my-1"},[a("b-col",{attrs:{sm:"4"}},[a("b-form-input",{attrs:{id:"input-default",placeholder:"hakutermi"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.search_term,callback:function(e){t.search_term=e},expression:"search_term"}}),a("b-button",{on:{click:t.search}},[t._v("hae")]),t.error?a("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e()],1),a("b-col",[a("b-form-select",{attrs:{options:t.statuses},on:{change:t.search},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}})],1),a("b-col",[a("div",{staticClass:"alert alert-info"},[t._v("lainahaku hakee teoksen tiedoista. Tietyn henkilön lainat löytyy asiakashaun kautta.")])])],1),a("b-row",[0!=t.search_result.length?a("div",[a("b-table",{attrs:{small:"",striped:"",hover:"",items:t.search_result,fields:t.fields},scopedSlots:t._u([{key:"cell(teoksen_tiedot)",fn:function(e){return[a("b-link",{attrs:{to:{path:"/pyynnot/"+e.item._id}}},[t._v(t._s(e.item.teoksen_tiedot))])]}},{key:"cell(tilaaja)",fn:function(e){return[e.item.tilaaja?a("b-link",{attrs:{to:{path:"/asiakkaat/"+e.item.tilaaja._id}}},[t._v(t._s(e.item.tilaaja.sukunimi)+", "+t._s(e.item.tilaaja.etunimi))]):t._e()]}},{key:"cell(tilaus_saatu.kirjaston_nimi)",fn:function(e){return[a("div",[e.item.tilaus_saatu?a("b-link",{attrs:{to:"/kirjastot/"+e.item.tilaus_saatu.kirjasto_id}},[t._v(t._s(e.value))]):t._e()],1)]}},{key:"cell(tilaus_saatu.pvm_erapaiva)",fn:function(t){return[a("DueDate",{attrs:{item:t.item}})]}}],null,!1,1711254347)})],1):a("div",[t._v("ei tuloksia")])])],1),a("b-tab",{attrs:{title:"erääntyneet"}},[0!=t.overdue.length?[a("div",[t._v("erääntyneitä lainoja "+t._s(t.overdue.length))]),a("b-table",{attrs:{small:"",striped:"",hover:"",items:t.overdue,fields:t.fields},scopedSlots:t._u([{key:"cell(teoksen_tiedot)",fn:function(e){return[a("b-link",{attrs:{to:{path:"/pyynnot/"+e.item._id}}},[t._v(t._s(e.value))])]}},{key:"cell(tilaaja)",fn:function(e){return[a("div",[e.item.tilaaja?a("b-link",{attrs:{to:"/asiakkaat/"+e.value._id}},[t._v(t._s(e.value.etunimi)+" "+t._s(e.value.sukunimi)+" ")]):t._e()],1)]}},{key:"cell(tilaus_saatu.pvm_erapaiva)",fn:function(t){return[a("DueDate",{attrs:{item:t.item}})]}}],null,!1,3871784930)})]:t._e()],2)],1)],1)])},n=[],r=a("1da1"),s=(a("d3b7"),a("96cf"),a("bc3a")),o=a.n(s),l=a("5370"),u=a("96dd"),c={name:"WELoans",components:{DueDate:l["a"]},data:function(){return{search_result:[],search_term:"",current:null,loading:!1,error:null,overdue:[],loan_count:0,status:"lainassa",statuses:["ei valintaa","kasittelyssa","lainassa","tilattu","arkistoitu","peruttu"],fields:[{key:"_id",label:"tunnus"},{key:"teoksen_tiedot",label:"kirjan nimi"},{key:"tilaaja",label:"tilaaja"},{key:"tilaus_saatu.kirjaston_nimi",label:"kirjasto"},{key:"status",label:"status"},{key:"tilaus_saatu.pvm_erapaiva",label:"eräpäivä",sortable:!0}]}},methods:{getOverdueLoans:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o()(t.$G.api_url+"/api/pyynnot/overdue_loans");case 2:a=e.sent,t.overdue=a.data;case 4:case"end":return e.stop()}}),e)})))()},search:function(){var t=this;if(""!=this.search_term){this.error=null;var e="";e="ei valintaa"==this.status?"?search="+this.search_term:"?search="+this.search_term+"&status="+this.status+"&sort=tilaus_saatu.pvm_erapaiva&reverse=1",fetch(this.$G.api_url+"/api/pyynnot"+e).then((function(t){if(!t.ok)throw t.status;return t.json()})).then((function(e){t.search_result=e,t.ready=!0})).catch((function(e){console.log("error"+e),t.error="virhe: "+e}))}else this.error="anna hakuehto"}},mounted:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u["a"].getLoanCount();case 2:a=e.sent,t.loan_count=a.data;case 4:case"end":return e.stop()}}),e)})))()}},d=c,_=a("2877"),h=Object(_["a"])(d,i,n,!1,null,null,null);e["a"]=h.exports},bb25:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",{attrs:{fluid:""}},[a("h1",[t._v("Organisaatiot")]),t.current||""!=t.mode?t._e():a("b-card",{attrs:{title:"haku"}},[a("b-row",{staticClass:"my-1"},[a("b-col",{attrs:{sm:"4"}},[a("b-form-input",{attrs:{id:"input-default",placeholder:"hae nimen alkukirjaimilla"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.search_term,callback:function(e){t.search_term=e},expression:"search_term"}}),a("b-button",{on:{click:t.search}},[t._v("hae")])],1)],1)],1),t.current||""!=t.mode?t._e():a("b-button",{staticClass:"float-right",staticStyle:{margin:"20px"},attrs:{variant:"primary"},on:{click:function(e){t.mode="add_new"}}},[t._v("lisää uusi")]),0===t.search_result.length||t.current||""!=t.mode?t._e():a("div",[a("b-table",{attrs:{items:t.search_result,fields:t.fields},scopedSlots:t._u([{key:"cell(sahkoposti)",fn:function(e){return[a("b",{staticClass:"text-info"},[t._v(t._s(e.value))])]}},{key:"cell(nimi)",fn:function(e){return[a("b-link",{attrs:{to:"/organisaatiot/"+e.item._id}},[t._v(t._s(e.value))])]}}],null,!1,1488930706)})],1),t.current&&"edit"!=t.mode?a("b-card",{attrs:{title:t.current.nimi,"header-bg-variant":"dark"}},[a("table",t._l(t.fields,(function(e){return a("tr",{key:e.key},[a("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(e.key))]),a("td",[a("b",[t._v(t._s(t.current[e.key]))])])])})),0),"edit"!=t.mode?a("b-icon",{staticClass:"float-right pointer",attrs:{icon:"pen",variant:"primary"},on:{click:function(e){t.mode="edit"}}},[t._v("muokkaa")]):t._e()],1):t._e(),t.current&&"edit"==t.mode?a("b-card",{attrs:{title:t.current.nimi,"header-bg-variant":"dark"}},["edit"==t.mode?a("table",t._l(t.fields,(function(e){return a("tr",{key:e.key},[a("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(e.key))]),a("td",[a("b-form-input",{model:{value:t.current[e.key],callback:function(a){t.$set(t.current,e.key,a)},expression:"current[field.key]"}})],1)])})),0):t._e(),a("b-container",[a("b-button",{staticClass:"float-right",staticStyle:{"margin-left":"20px"},attrs:{variant:"primary"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")]),a("b-button",{staticClass:"float-right",on:{click:function(e){return t.loadData()}}},[t._v("peru")])],1)],1):t._e(),t.current?a("b-link",{attrs:{to:"/organisaatiot"}},[t._v("takaisin hakuun")]):t._e(),"add_new"==t.mode?a("b-card",{attrs:{title:"uusi organisaatio","header-bg-variant":"dark"}},[a("table",t._l(t.fields,(function(e){return a("tr",{key:e.key},[a("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(e.key))]),a("td",[a("b-form-input",{model:{value:t.new_obj[e.key],callback:function(a){t.$set(t.new_obj,e.key,a)},expression:"new_obj[field.key]"}})],1)])})),0),a("b-button",{staticClass:"float-right",staticStyle:{"margin-left":"20px"},attrs:{variant:"primary"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")]),a("b-button",{staticClass:"float-right",on:{click:function(e){t.mode=""}}},[t._v("peru")])],1):t._e(),a("br"),a("br"),t.current?a("h2",[t._v("maksut")]):t._e(),t.current?a("b-card",[a("b-table",{attrs:{items:t.requests,fields:t.request_fields},scopedSlots:t._u([{key:"cell(tiedot)",fn:function(e){return[a("b-link",{attrs:{to:"/pyynnot/"+e.item._id}},[t._v(t._s(e.item.teoksen_tiedot))])]}},{key:"cell(tilaaja)",fn:function(e){return[a("b-link",{attrs:{to:"/asiakkaat/"+e.item.tilaaja._id}},[t._v(t._s(e.value.sukunimi)+", "+t._s(e.value.etunimi))])]}}],null,!1,2186137256)})],1):t._e()],1)},n=[],r=a("1da1"),s=(a("96cf"),a("d3b7"),a("e9c4"),a("caad"),a("2532"),{name:"WEOrganisation",data:function(){return{search_term:"",search_result:[],current:null,requests:[],ready:!1,mode:"",new_obj:{},fields:[{key:"nimi"},{key:"kustannuspaikka"},{key:"huomio",label:"lisätieto"}],request_fields:[{key:"_id",label:"tunniste"},{key:"teos_on",label:"tyyppi"},{key:"tiedot"},{key:"tilaaja"},{key:"kasittelija",label:"käsittelijä"},{key:"status"},{key:"maksu"},{key:"maksaja_info"}]}},watch:{$route:function(t,e){this.$route.params.id?this.loadData():this.current=null}},methods:{saveForm:function(){var t=this;console.log("saveform"),"add_new"==this.mode?fetch(this.$G.api_url+"/api/organisaatiot",{method:"POST",body:JSON.stringify(this.new_obj)}).then((function(t){return t.json()})).then((function(e){t.$router.push("/organisaatiot/"+e._id)})).catch((function(t){console.log("error"+t)})):"edit"==this.mode&&(console.log("edit"),delete this.current._id,console.log(this.current),fetch(this.$G.api_url+"/api/organisaatiot/"+this.$route.params.id,{method:"PUT",body:JSON.stringify(this.current)}).then((function(t){return t.json()})).then((function(e){t.loadData()})).catch((function(t){console.log("error"+t)})))},editForm:function(){console.log(this.edit),console.log("sdf"),this.edit=!this.edit},loadRelated:function(){var t=this;fetch(this.$G.api_url+"/api/pyynnot/?sort=_id&reverse=1&maksaja_varmistettu="+this.$route.params.id).then((function(t){return t.json()})).then((function(e){t.requests=e,t.ready=!0})).catch((function(t){console.log("error"+t)}))},loadData:function(){var t=this;this.$route.params.id&&(this.mode="",this.ready=!1,this.current=null,fetch(this.$G.api_url+"/api/organisaatiot/"+this.$route.params.id).then((function(t){return t.json()})).then((function(e){t.current=e,t.loadRelated()})).catch((function(t){console.log("error"+t)})))},search:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.current=null,""===t.search_term){e.next=10;break}return t.search_term.includes("*")||(t.search_term=t.search_term+"*"),a="nimi="+t.search_term,e.next=6,fetch(t.$G.api_url+"/api/organisaatiot?"+a);case 6:return i=e.sent,e.next=9,i.json();case 9:t.search_result=e.sent;case 10:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.loadData()}}),o=s,l=a("2877"),u=Object(l["a"])(o,i,n,!1,null,null,null);e["a"]=u.exports},c60a:function(t,e,a){},c678:function(t,e,a){"use strict";a("82fd")},ccd2:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",{attrs:{fluid:""}},[a("h1",[t._v("Kirjastot")]),t.current||""!=t.mode?t._e():a("b-card",{attrs:{title:"haku"}},[a("b-row",{staticClass:"my-1"},[a("b-col",{attrs:{sm:"4"}},[a("b-form-input",{attrs:{id:"input-default",placeholder:"hae nimen alkukirjaimilla"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.search_term,callback:function(e){t.search_term=e},expression:"search_term"}}),a("label",[t._v("TAI ")]),a("b-form-input",{attrs:{id:"input-default2",placeholder:"hae lyhenteellä"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.search_lyhenne,callback:function(e){t.search_lyhenne=e},expression:"search_lyhenne"}}),a("b-button",{on:{click:t.search}},[t._v("hae")])],1)],1)],1),a("br"),t.current||""!=t.mode?t._e():a("b-button",{staticClass:"float-right",attrs:{variant:"primary"},on:{click:function(e){t.mode="add_new"}}},[t._v("lisää uusi")]),t.loading?a("div",{staticClass:"alert alert-info"},[t._v("haen...")]):t._e(),0===t.search_result.length||t.current||""!=t.mode?t._e():a("div",[a("b-table",{attrs:{items:t.search_result,fields:t.fields_search},scopedSlots:t._u([{key:"cell(sahkoposti)",fn:function(e){return[a("b",{staticClass:"text-info"},[t._v(t._s(e.value))])]}},{key:"cell(nimi)",fn:function(e){return[a("b-link",{attrs:{to:"/kirjastot/"+e.item._id}},[t._v(t._s(e.value))])]}}],null,!1,1824578108)})],1),t.current&&"edit"!=t.mode?a("b-card",{attrs:{title:t.current.nimi+" ("+t.current.lyhenne+")","header-bg-variant":"dark"}},[a("table",{staticClass:"table table-sm"},t._l(t.fields,(function(e){return a("tr",{key:e.key},[a("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(e.key))]),"lomake"==e.key||"kotisivut"==e.key?a("td",[a("a",{attrs:{target:"_blank",href:t.getLink(t.current[e.key])}},[t._v(t._s(t.current[e.key]))])]):a("td",[a("b",[t._v(t._s(t.current[e.key]))])])])})),0),"edit"!=t.mode?a("b-icon",{staticClass:"float-right pointer",attrs:{icon:"pen",variant:"primary"},on:{click:function(e){t.mode="edit"}}},[t._v("muokkaa")]):t._e()],1):t._e(),t.current&&"edit"==t.mode?a("b-card",{attrs:{title:t.current.nimi,"header-bg-variant":"dark"}},[a("table",{staticClass:"table table-striped"},t._l(t.fields,(function(e){return a("tr",{key:e.key},["_id"!=e.key?[e.label?a("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(e.label))]):a("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(e.key))]),a("td",{staticStyle:{"min-width":"350px"}},[a("b-form-input",{model:{value:t.current[e.key],callback:function(a){t.$set(t.current,e.key,a)},expression:"current[field.key]"}})],1)]:t._e()],2)})),0),a("b-container",[a("b-button",{staticClass:"float-right",staticStyle:{"margin-left":"20px"},attrs:{variant:"primary"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")]),a("b-button",{staticClass:"float-right",on:{click:function(e){return t.loadData()}}},[t._v("peru")])],1)],1):t._e(),t.current?a("b-link",{attrs:{to:"/kirjastot"}},[t._v("takaisin hakuun")]):t._e(),"add_new"==t.mode?a("b-card",{attrs:{title:"uusi kirjasto","header-bg-variant":"dark"}},[a("table",t._l(t.fields,(function(e){return a("tr",{key:e.key},[e.label?a("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(e.label))]):a("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(e.key))]),a("td",{staticStyle:{"min-width":"350px"}},[a("b-form-input",{model:{value:t.new_obj[e.key],callback:function(a){t.$set(t.new_obj,e.key,a)},expression:"new_obj[field.key]"}})],1)])})),0),a("b-button",{on:{click:function(e){t.mode=""}}},[t._v("peru")]),a("b-button",{attrs:{variant:"info"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")])],1):t._e(),t.error?a("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e(),a("br"),a("br"),t.current?a("h2",[t._v("lainassa olevat")]):t._e(),t.current?a("b-card",[a("b-table",{attrs:{items:t.requests,fields:t.request_fields},scopedSlots:t._u([{key:"cell(tiedot)",fn:function(e){return[a("b-link",{attrs:{to:"/pyynnot/"+e.item._id}},[t._v(t._s(e.item.teoksen_tiedot))])]}},{key:"cell(tilaaja)",fn:function(e){return[e.item.tilaaja?a("b-link",{attrs:{to:{path:"/asiakkaat/"+e.item.tilaaja._id}}},[t._v(t._s(e.item.tilaaja.sukunimi)+", "+t._s(e.item.tilaaja.etunimi))]):t._e()]}},{key:"cell(erapaiva)",fn:function(t){return[a("DueDate",{attrs:{item:t.item}})]}}],null,!1,458813704)})],1):t._e()],1)},n=[],r=a("1da1"),s=(a("96cf"),a("caad"),a("2532"),a("ac1f"),a("5319"),a("d3b7"),a("e9c4"),a("5370")),o={name:"WELibrary",components:{DueDate:s["a"]},data:function(){return{search_term:"",search_lyhenne:"",search_result:[],current:null,requests:[],ready:!1,loading:!1,error:null,mode:"",new_obj:{},fields_search:[{key:"nimi"},{key:"lyhenne"},{key:"email",label:"sähköposti"},{key:"puhelin"}],fields:[{key:"nimi"},{key:"puhelin"},{key:"lyhenne"},{key:"email",label:"sähköposti"},{key:"osoite"},{key:"huomio"},{key:"lomake",label:"tilauslomakkeen URL"},{key:"kotisivut",label:"kotisivujen URL"}],request_fields:[{key:"_id",label:"tunniste"},{key:"tiedot"},{key:"status"},{key:"tilaaja",label:"asiakas"},{key:"erapaiva",label:"eräpäivä"}]}},watch:{$route:function(t,e){t.path.includes("/kirjastot")&&(this.$route.params.id?this.loadData():e.path.includes("/kirjastot")?this.current=null:this.current&&this.$router.replace({path:"/kirjastot/"+this.current._id}))}},methods:{getLink:function(t){if(t)return t.includes("http")?t:"http://"+t},saveForm:function(){var t=this;if(console.log("saveform"),"add_new"==this.mode){if(!this.new_obj.nimi||""==this.new_obj.nimi)return void alert("Nimi täytyy antaa");fetch(this.$G.api_url+"/api/kirjastot",{method:"POST",body:JSON.stringify(this.new_obj)}).then((function(t){return t.json()})).then((function(e){t.$router.push("/kirjastot/"+e._id)})).catch((function(t){console.log("error"+t)}))}else"edit"==this.mode&&(console.log("edit"),delete this.current._id,console.log(this.current),fetch(this.$G.api_url+"/api/kirjastot/"+this.$route.params.id,{method:"PUT",body:JSON.stringify(this.current)}).then((function(t){return t.json()})).then((function(e){t.loadData()})).catch((function(t){console.log("error"+t)})))},editForm:function(){console.log(this.edit),this.edit=!this.edit},loadData:function(){var t=this;this.$route.params.id&&(this.mode="",this.error=null,this.ready=!1,this.loading=!0,this.current=null,fetch(this.$G.api_url+"/api/kirjastot/"+this.$route.params.id).then((function(t){return t.json()})).then((function(e){t.current=e,t.loadRelated()})).catch((function(e){t.error=e,console.log("error"+e)})))},loadRelated:function(){var t=this;fetch(this.$G.api_url+"/api/kirjastot/"+this.$route.params.id+"/loans").then((function(t){return t.json()})).then((function(e){t.requests=e,t.ready=!0,t.loading=!1})).catch((function(t){console.log("error"+t)}))},search:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.current=null,t.error=null,t.loading=!0,a="",""===t.search_term){e.next=16;break}return t.search_term.includes("*")||(t.search_term=t.search_term+"*"),a="nimi="+t.search_term,e.next=9,fetch(t.$G.api_url+"/api/kirjastot?"+a);case 9:return i=e.sent,e.next=12,i.json();case 12:t.search_result=e.sent,t.loading=!1,e.next=25;break;case 16:if(""===t.search_lyhenne){e.next=25;break}return a="lyhenne="+t.search_lyhenne,e.next=20,fetch(t.$G.api_url+"/api/kirjastot?"+a);case 20:return n=e.sent,e.next=23,n.json();case 23:t.search_result=e.sent,t.loading=!1;case 25:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.loadData()}},l=o,u=a("2877"),c=Object(u["a"])(l,i,n,!1,null,null,null);e["a"]=c.exports},df45:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-container",[t.ready?i("div",[i("b-card",{attrs:{header:"kaukolainapyyntö"},scopedSlots:t._u([{key:"header",fn:function(){return[i("b-nav",{staticClass:"float-right"},[i("b-nav-item-dropdown",{attrs:{id:"my-nav-dropdown",text:"toiminnot","toggle-class":"nav-link-custom",right:""}},["lainassa"==t.request.status?i("b-dropdown-item",{staticClass:"float-right",on:{click:function(e){return t.setReturned()}}},[i("b",[t._v("merkitse palautetuksi ja arkistoi")])]):t._e(),t.request.tilaus_saatu&&"lainassa"==t.request.tilaus_saatu.status?i("b-dropdown-item",{on:{click:function(e){return t.openKarhuRequest()}}},[t._v("lähetä karhuviesti")]):t._e(),"kasittelyssa"==t.request.status||"tilattu"==t.request.status||"uusi"==t.request.status?i("b-dropdown-item",{on:{click:function(e){t.show=!t.show}}},[i("b",[t._v("tee uusi tilaus")])]):t._e(),i("b-dropdown-divider"),"kasittelyssa"!=t.request.status&&"tilattu"!=t.request.status||"artikkeli"!=t.request.teos_on?t._e():i("b-dropdown-item",{on:{click:function(e){return t.convertToBook()}}},[t._v("muuta kirjapyynnöksi")]),"peruttu"!==t.request.status||t.request.tilaus_saatu?t._e():i("b-dropdown-item",{on:{click:function(e){t.show_modal_cancel_archive=!0}}},[t._v("palauta käsittelyyn")]),"peruttu"==t.request.status||t.request.tilaus_saatu?t._e():i("b-dropdown-item",{on:{click:function(e){return t.openCancelRequest()}}},[t._v("peruuta pyyntö")])],1)],1),i("h3",[t._v(t._s(t.request.teos_on)+"pyyntö: "),i("b",[t._v(t._s(t.request._id))]),t._v(" ("),i("span",{staticClass:"text-info"},[t._v(t._s(t.$G.getStatus(t.request.status)))]),t._v(")")])]},proxy:!0}],null,!1,2560333342)},[i("b-card-body",[i("b-card-title",[t._v(t._s(t.request.teoksen_tiedot)+" "),"arkistoitu"!=t.request.status?i("b-icon",{staticClass:"float-right cursor",attrs:{icon:"pen",variant:"primary",id:"edit-note"},on:{click:function(e){t.show_modal_title=!0}}}):t._e()],1),i("table",{staticClass:"table"},[i("tbody",[t.request.tilaaja?i("tr",[i("td",{staticStyle:{width:"200px"}},[t._v("asiakas")]),i("td",[i("b",[i("b-link",{attrs:{to:"/asiakkaat/"+t.request.tilaaja._id}},[t._v(t._s(t.request.tilaaja.etunimi)+" "+t._s(t.request.tilaaja.sukunimi)+" ")])],1),t.request.tilaaja.sukunimi&&""!=t.request.tilaaja.sukunimi?t._e():i("b-link",{attrs:{to:"/asiakkaat/"+t.request.tilaaja._id}},[t._v("nimi puuttuu ")]),t.isExternal()?i("div",[i("p",{staticClass:"alert alert-warning"},[t._v("Kaukolainapyyntö on tehty kaukolainahenkilökunnan tunnuksilla, joten asiakas täytyy liittää pyyntöön käsin (ja mahdollisesti lisätä sähköposti) tai luoda uusi asiakas.")]),i("p",[i("b",[t._v(t._s(t.request.sukunimi)+", "+t._s(t.request.etunimi))])]),i("p",[i("b-input",{nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchClients()}},model:{value:t.client_query,callback:function(e){t.client_query=e},expression:"client_query"}}),i("b-button",{on:{click:function(e){return t.searchClients()}}},[t._v("hae")])],1),t.clients_result&&t.clients_result.length?[i("b-table",{attrs:{small:"",striped:"",hover:"",items:t.clients_result,fields:t.client_fields},scopedSlots:t._u([{key:"cell(sahkoposti)",fn:function(e){return[t._v(" "+t._s(e.value.join(", "))+" ")]}},{key:"cell(valitse)",fn:function(e){return[i("b-button",{attrs:{title:"liitä asiakas ja anna tarvittaessa toinen sähköposti",variant:"primary"},on:{click:function(a){return t.openJoinClient(e.item)}}},[t._v("liitä")])]}}],null,!1,1859691286)})]:i("div",[t._v("ei tuloksia")]),i("b-button",{staticClass:"float-right",staticStyle:{"margin-top":"40px"},attrs:{variant:"primary"},on:{click:function(e){t.show_modal_external=!t.show_modal_external}}},[t._v("Luo uusi asiakas")])],2):t._e()],1),i("td")]):i("tr",[i("td",[t._v("asiakas")]),i("td",[t.isExternal()?i("div",[i("p",[i("b",[t._v(t._s(t.request.sukunimi)+", "+t._s(t.request.etunimi))])]),i("p",{staticClass:"alert alert-warning"},[t._v("Kaukolainapyyntö on tehty kaukolainahenkilökunnan tunnuksilla, joten asiakas täytyy liittää pyyntöön käsin (ja mahdollisesti lisätä sähköposti) tai luoda uusi asiakas.")]),i("p",[i("b-input",{nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchClients()}},model:{value:t.client_query,callback:function(e){t.client_query=e},expression:"client_query"}}),i("b-button",{on:{click:function(e){return t.searchClients()}}},[t._v("hae")])],1),t.clients_result&&t.clients_result.length?[i("b-table",{attrs:{small:"",striped:"",hover:"",items:t.clients_result,fields:t.client_fields},scopedSlots:t._u([{key:"cell(sahkoposti)",fn:function(e){return[t._v(" "+t._s(e.value.join(", "))+" ")]}},{key:"cell(valitse)",fn:function(e){return[i("b-button",{attrs:{title:"liitä asiakas ja anna tarvittaessa toinen sähköposti",variant:"primary"},on:{click:function(a){return t.openJoinClient(e.item)}}},[t._v("liitä")])]}}],null,!1,1859691286)})]:i("div",[t._v("ei tuloksia")]),i("b-button",{staticClass:"float-right",staticStyle:{"margin-top":"40px"},attrs:{variant:"primary"},on:{click:function(e){t.show_modal_external=!t.show_modal_external}}},[t._v("Luo uusi asiakas")])],2):t._e()]),i("td")]),"artikkeli"==t.request.teos_on?[i("tr",[i("td",{staticStyle:{"min-width":"200px"}},[t._v("mistä löysit?")]),i("td",[i("b",[t._v(t._s(t.request.mista_loysit_julkaisun_tiedot))])]),i("td")])]:t._e(),i("tr",[i("td",[t._v(" maksaja ")]),i("td",[t.request.hintakatto?i("b-badge",{staticClass:"float-right alert alert-info"},[t._v("hintakatto: "+t._s(t.request.hintakatto))]):t._e(),t.request.maksaja_varmistettu||"asiakas"==t.request.maksaja?t._e():i("div",{staticClass:"alert alert-warning"},[t._v("maksajaa ei ole liitetty mihinkään organisaatioon")]),"asiakas"==t.request.maksaja?i("div",[i("b",[t._v("asiakas itse")])]):t.request.maksaja_varmistettu?i("div",[i("span",{attrs:{title:"lomakkeelta tullut maksajatieto"}},[t._v(t._s(t.request.laitos)+": ")]),i("b-link",{attrs:{title:"linkitetty maksajatieto",to:"/organisaatiot/"+t.request.maksaja_varmistettu._id}},[t._v(t._s(t.request.maksaja_varmistettu.nimi))])],1):i("div",[t.request.maksaja_varmistettu?t._e():i("b",[t._v(" "+t._s(t.request.maksaja)+": "+t._s(t.request.laitos)+" "+t._s(t.request.projekti))])]),t.request.maksaja_varmistettu?i("div",[i("table",{staticClass:"table table-striped"},[i("tbody",[t.request.projekti?i("tr",[i("td",[t._v("projekti:")]),i("td",[i("b",[t._v(" "+t._s(t.request.projekti))])])]):t._e(),t.request.kustannuspaikka?i("tr",[i("td",[t._v("kustannuspaikka:")]),i("td",[i("b",[t._v(" "+t._s(t.request.kustannuspaikka))])])]):t._e()])]),t.request.maksaja_info&&t.request.maksaja_varmistettu?i("div",{staticClass:"alert alert-info"},[t._v(t._s(t.request.maksaja_info))]):t._e()]):t._e()],1),i("td",{attrs:{title:"muokkaa maksajatietoja"}},["arkistoitu"!=t.request.status?i("b-icon",{staticClass:"float-right cursor",attrs:{icon:"pen",variant:"primary",id:"edit-note"},on:{click:function(e){t.show_modal_payer=!0}}}):t._e()],1)]),i("tr",[i("td",{staticStyle:{"min-width":"200px"}},[t._v("huomautuksia "),i("br"),t._v("(sisäinen)")]),i("td",[""!=t.request.huomautuksia?i("div",{staticClass:"alert alert-info",domProps:{innerHTML:t._s(t.$G.renderBreaks(t.request.huomautuksia,"\n"))}}):t._e()]),i("td",{attrs:{title:"muokkaa huomautuksia"}},[i("b-icon",{staticClass:"float-right cursor",attrs:{icon:"pen",variant:"primary",id:"edit-note"},on:{click:function(e){t.show_modal_note=!t.show_modal_note}}})],1)])],2)]),t.request.tarvitaan_viimeistaan?i("div",{staticClass:"alert alert-info"},[t._v("tarvitaan viimeistään: "+t._s(t.request.tarvitaan_viimeistaan))]):t._e(),t.request.o_id?i("div",{staticClass:"alert alert-danger"},[t._v("Vanha laina Kakesta!")]):t._e(),t.request.peruutuksen_syy?i("div",[t._v("peruutuksen syy: "),i("b",{staticClass:"text-danger"},[t._v(t._s(t.request.peruutuksen_syy)+" ")])]):t._e(),"yes"==t.request.o_retudate_has_value?i("div",{staticClass:"alert alert-info"},[t._v("Tämä lienee palautettu "+t._s(t.request.pvm_palautettu)+"?")]):t._e(),t.request.karhut&&t.request.karhut.length?i("div",t._l(t.request.karhut,(function(e){return i("div",{key:e,staticClass:"alert alert-danger"},[t._v(" karhuttu: "+t._s(e)+" ")])})),0):t._e()],1)],1),i("br"),"lainassa"!=t.request.status&&"arkistoitu"!=t.request.status||!t.request.tilaus_saatu?t._e():i("b-card",{attrs:{footer:"palautettu: "+t.formatDate(t.request.tilaus_saatu.pvm_palautettu,"reverse","."),"header-class":"dim","header-text-variant":"white"},scopedSlots:t._u([{key:"header",fn:function(){return[i("h6",{staticClass:"mb-0"},[i("b",[t._v("kaukolaina")]),t._v(" (saapunut: "+t._s(t.formatDate(t.request.tilaus_saatu.pvm_saapunut,"reverse","."))+")")])]},proxy:!0}],null,!1,3341928750)},[i("table",{staticClass:"table"},[i("tr",[i("td",[t._v("kirjastosta")]),i("td",[i("b-link",{attrs:{"text-variant":"white",to:"/kirjastot/"+t.request.tilaus_saatu.kirjasto_id}},[t._v(" "+t._s(t.request.tilaus_saatu.kirjaston_nimi))])],1),i("td")]),"kirja"==t.request.teos_on?i("tr",[i("td",{staticStyle:{width:"200px"}},[t._v("eräpäivä")]),i("td",[i("DueDate",{attrs:{item:t.request}})],1),i("td",{attrs:{title:"muokkaa eräpäivää"},on:{click:function(e){t.show_modal_loan_date=!0}}},[i("b-icon",{staticClass:"float-right cursor",attrs:{icon:"pen",variant:"primary",id:"edit-note"}})],1)]):t._e(),i("tr",[i("td",{staticStyle:{width:"200px"}},[t._v("maksu")]),i("td",[t._v(t._s(t.request.tilaus_saatu.maksu))]),i("td")]),i("tr",[i("td",{staticStyle:{width:"200px"}},[t._v("tilausviesti")]),i("td",[i("div",{staticClass:"cursor",attrs:{size:"sm"},on:{click:function(e){return t.$root.$emit("bv::toggle::collapse",t.request.tilaus_saatu._id)}}},[i("b-icon",{attrs:{icon:"caret-right"}}),t._v("tilausviesti")],1),i("b-collapse",{attrs:{id:t.request.tilaus_saatu._id,accordion:"my-accordion",role:"tabpanel"}},[i("div",{domProps:{innerHTML:t._s(t.$G.renderBreaks(t.request.tilaus_saatu.viesti,"\n"))}})])],1),i("td")])])]),i("br"),t.orders.length?i("div",[i("b-table",{staticClass:"table table-striped",attrs:{items:t.orders,fields:t.order_fields},scopedSlots:t._u([{key:"cell(kirjaston_nimi)",fn:function(e){return[i("div",{staticStyle:{"min-width":"350px"}},[i("b-link",{attrs:{to:"/kirjastot/"+e.item.kirjasto_id}},[t._v(" "+t._s(e.value))]),i("div",{staticClass:"cursor",attrs:{size:"sm"},on:{click:function(a){return t.$root.$emit("bv::toggle::collapse",e.item._id)}}},[i("b-icon",{attrs:{icon:"caret-right"}}),t._v("tilausviesti")],1),i("b-collapse",{attrs:{id:e.item._id,accordion:"my-accordion",role:"tabpanel"}},[i("div",{domProps:{innerHTML:t._s(t.$G.renderBreaks(e.item.viesti,"\n"))}})])],1)]}},{key:"cell(pvm)",fn:function(e){return[e.item.recdate?i("div",[t._v(t._s(e.item.recdate))]):i("div",[t._v(t._s(t.$G.getDateFromUUID(e.item._id)))])]}},{key:"cell(pvm_saapunut)",fn:function(e){return[i("div",[t._v(t._s(t.formatDate(e.value)))])]}},{key:"cell(pvm_palautettu)",fn:function(e){return[i("b",{staticClass:"text text-info"},[t._v(t._s(t.formatDate(e.value)))])]}},{key:"cell(status)",fn:function(e){return[i("b",{staticClass:"text text-info"},[t._v(t._s(e.value.replace("_"," ")))])]}},{key:"cell(toiminto)",fn:function(e){return["arkistoitu"!==t.request.status?i("b-nav",{staticClass:"float-right"},["palautettu"!==e.item.status&&"ei_saatavilla"!==e.item.status?i("b-nav-item-dropdown",{attrs:{id:"tilaus-nav-dropdown",text:"toiminnot","toggle-class":"nav-link-custom",right:""}},[i("b-dropdown-divider"),"kasittelyssa"!=t.request.status&&"tilattu"!=t.request.status||"kirja"!=t.request.teos_on?t._e():i("b-dropdown-item",{staticClass:"float-right",attrs:{variant:"primary"},on:{click:function(a){return t.openArrived(e.item)}}},[t._v("merkitse saapuneeksi ja lainaa")]),"kasittelyssa"!=t.request.status&&"tilattu"!=t.request.status||"artikkeli"!=t.request.teos_on?t._e():i("b-dropdown-item",{staticClass:"float-right",attrs:{variant:"primary"},on:{click:function(a){return t.openArrived(e.item)}}},[t._v("merkitse saapuneeksi ja arkistoi")]),e.item.status&&"tilattu"!=e.item.status?t._e():i("b-dropdown-item",{on:{click:function(a){return t.setNotAvailable(e.item._id)}}},[t._v("ei saatavilla")])],1):t._e()],1):t._e()]}}],null,!1,1422393677)})],1):t._e(),t.error?i("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e(),i("b-modal",{attrs:{title:"muuta eräpäivää","cancel-title":"peru","ok-title":"tallenna","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:t.setLoanDate},model:{value:t.show_modal_loan_date,callback:function(e){t.show_modal_loan_date=e},expression:"show_modal_loan_date"}},[t.request.tilaus_saatu?i("div",{staticClass:"alert alert-info"},[t._v("nykyinen eräpäivä: "+t._s(t.formatDate(t.request.tilaus_saatu.pvm_erapaiva,"reverse",".")))]):t._e(),t._v(" uusi eräpäivä: "),i("b-input",{model:{value:t.new_loan_date,callback:function(e){t.new_loan_date=e},expression:"new_loan_date"}}),i("b-form-checkbox",{attrs:{id:"checkbox-ei-peruutusviestia",name:"checkbox-ei-peruutusviestia",value:"no","unchecked-value":"yes"},on:{change:function(e){return t.setDueDate()}},model:{value:t.tilaus_uusittavissa,callback:function(e){t.tilaus_uusittavissa=e},expression:"tilaus_uusittavissa"}},[t._v(" ei voi enää uusia ")]),"no"==t.tilaus_uusittavissa?[t._v("lisätieto: "),i("b-input",{model:{value:t.tilaus_info,callback:function(e){t.tilaus_info=e},expression:"tilaus_info"}})]:t._e()],2),i("b-modal",{attrs:{title:"Muokkaa otsikkoa","cancel-title":"peru","ok-title":"tallenna","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:t.updateTitle},model:{value:t.show_modal_title,callback:function(e){t.show_modal_title=e},expression:"show_modal_title"}},[i("b-form-textarea",{attrs:{rows:"3"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),t.sending?i("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],1),i("b-modal",{attrs:{title:"Lähetä karhuviesti","cancel-title":"peru","ok-title":"lähetä","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:t.sendDueNotice},model:{value:t.show_modal_due_notice,callback:function(e){t.show_modal_due_notice=e},expression:"show_modal_due_notice"}},[t._v(" karhuviesti asiakkaalle: "),i("b-form-textarea",{attrs:{rows:"6"},model:{value:t.due_notice,callback:function(e){t.due_notice=e},expression:"due_notice"}}),t.sending?i("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],1),i("b-modal",{attrs:{title:"peruuta kaukolainapyyntö","cancel-title":"peru","ok-title":"merkitse peruutetuksi","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:function(e){return t.setCancelled()}},model:{value:t.show_modal_cancel_request,callback:function(e){t.show_modal_cancel_request=e},expression:"show_modal_cancel_request"}},["lainassa"==t.request.status?i("div",{staticClass:"alert alert-danger"},[t._v("Teos on lainassa! ")]):t._e(),"yes"===t.laheta_peruutusilmoitus?[t._v(" peruutusviesti asiakkaalle: "),i("b-form-textarea",{attrs:{rows:"6"},model:{value:t.cancel_reason,callback:function(e){t.cancel_reason=e},expression:"cancel_reason"}})]:t._e(),i("b-form-checkbox",{attrs:{id:"checkbox-ei-peruutusviestia",name:"checkbox-ei-peruutusviestia",value:"yes","unchecked-value":"no"},model:{value:t.laheta_peruutusilmoitus,callback:function(e){t.laheta_peruutusilmoitus=e},expression:"laheta_peruutusilmoitus"}},[t._v(" lähetä sähköposti-ilmoitus asiakkaalle ")]),t.sending?i("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],2),i("b-modal",{attrs:{title:"palauta käsittelyyn","cancel-title":"peru","ok-title":"palauta käsittelyyn","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:function(e){return t.setNonArchived()}},model:{value:t.show_modal_cancel_archive,callback:function(e){t.show_modal_cancel_archive=e},expression:"show_modal_cancel_archive"}},[t.sending?i("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()]),i("b-modal",{attrs:{size:"lg",title:"merkitse saapuneeksi","cancel-title":"peru","ok-title":"merkitse saapuneeksi","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:t.setArrived},model:{value:t.show_modal_arrived,callback:function(e){t.show_modal_arrived=e},expression:"show_modal_arrived"}},[t.arrived_order?i("b-form-group",{staticStyle:{"max-width":"450px"}},["kirja"==t.request.teos_on?[i("label",[t._v("eräpäivä (pp.kk.vvvv)")]),i("b-input",{model:{value:t.arrived_order.erapaiva,callback:function(e){t.$set(t.arrived_order,"erapaiva",e)},expression:"arrived_order.erapaiva"}})]:t._e(),i("label",[t._v("maksu")]),i("b-input",{model:{value:t.arrived_order.maksu,callback:function(e){t.$set(t.arrived_order,"maksu",e)},expression:"arrived_order.maksu"}}),i("b-form-checkbox",{attrs:{id:"checkbox-2",name:"checkbox-2",value:"yes","unchecked-value":"no"},model:{value:t.laheta_saapumisilmoitus,callback:function(e){t.laheta_saapumisilmoitus=e},expression:"laheta_saapumisilmoitus"}},[t._v(" lähetä saapumisilmoitus ")])],2):t._e(),t.sending?i("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e(),t.error?i("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e()],1),i("b-modal",{attrs:{size:"lg",title:"huomautuksia","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:t.setNote,cancel:function(e){t.note=t.request.huomautuksia}},model:{value:t.show_modal_note,callback:function(e){t.show_modal_note=e},expression:"show_modal_note"}},[i("b-form-textarea",{attrs:{id:"textarea",placeholder:"",rows:"10"},model:{value:t.note,callback:function(e){t.note=e},expression:"note"}}),t.sending?i("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],1),i("b-modal",{attrs:{size:"lg",title:"tilauslomake","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},scopedSlots:t._u([{key:"modal-footer",fn:function(){return[i("div")]},proxy:!0}],null,!1,2017372688),model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[i("WEOrderForm",{attrs:{request:t.request},on:{exit:function(e){return t.loadData()}}})],1),i("b-modal",{attrs:{size:"lg",title:"maksaja","header-bg-variant":t.primaryBG,"header-text-variant":t.primaryText},on:{ok:t.setPayer,cancel:t.cancelPayer},model:{value:t.show_modal_payer,callback:function(e){t.show_modal_payer=e},expression:"show_modal_payer"}},[i("b-form-checkbox",{attrs:{id:"checkbox-1",name:"checkbox-1",value:"yes","unchecked-value":"no"},model:{value:t.payer_is_client,callback:function(e){t.payer_is_client=e},expression:"payer_is_client"}},[t._v(" asiakas maksaa itse ")]),"yes"!=t.payer_is_client?i("b-form",[i("b-form-group",{staticStyle:{"margin-top":"30px"}},[i("label",[t._v("valitse maksaja")]),i("b-select",{attrs:{options:t.organisations,"value-field":"_id","text-field":"nimi"},model:{value:t.payer_selected,callback:function(e){t.payer_selected=e},expression:"payer_selected"}}),t.payer_selected?i("b-form-textarea",{attrs:{id:"textarea",placeholder:"Lisätietoa maksuun liittyen...",rows:"3","max-rows":"6"},model:{value:t.payer_info,callback:function(e){t.payer_info=e},expression:"payer_info"}}):t._e()],1)],1):t._e(),t.sending?i("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],1),i("b-modal",{attrs:{title:"ulkopuolinen asiakas"},on:{ok:t.saveExternalClient},model:{value:t.show_modal_external,callback:function(e){t.show_modal_external=e},expression:"show_modal_external"}},[i("b-form-group",{staticStyle:{"margin-top":"30px"}},[i("label",[t._v("sukunimi")]),i("b-input",{model:{value:t.external_client.sukunimi,callback:function(e){t.$set(t.external_client,"sukunimi",e)},expression:"external_client.sukunimi"}}),i("label",[t._v("etunnimi")]),i("b-input",{model:{value:t.external_client.etunimi,callback:function(e){t.$set(t.external_client,"etunimi",e)},expression:"external_client.etunimi"}}),i("label",[t._v("sähköposti (PAKOLLINEN)")]),i("b-input",{model:{value:t.external_client.sahkoposti,callback:function(e){t.$set(t.external_client,"sahkoposti",e)},expression:"external_client.sahkoposti"}}),i("label",[t._v("kortin numero")]),i("b-input",{model:{value:t.external_client.kirjastokortin_numero,callback:function(e){t.$set(t.external_client,"kirjastokortin_numero",e)},expression:"external_client.kirjastokortin_numero"}})],1),t.sending?i("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],1),i("b-modal",{attrs:{title:"liitä asiakas pyyntöön","cancel-title":"peru","ok-title":"liitä"},on:{ok:t.saveJoinClient},model:{value:t.show_modal_join_client,callback:function(e){t.show_modal_join_client=e},expression:"show_modal_join_client"}},[t.join_client?i("b-form-group",{staticStyle:{"margin-top":"30px"}},[i("label",[t._v("sukunimi")]),i("p",[i("b",[t._v(t._s(t.join_client.sukunimi))])]),i("label",[t._v("etunnimi")]),i("p",[i("b",[t._v(t._s(t.join_client.etunimi))])]),i("label",[t._v("kortin numero")]),i("p",[t._v(t._s(t.join_client.kirjastokortin_numero))]),i("label",[t._v("sähköposti(t)")]),i("p",[i("b",[t._v(t._s(t.join_client.sahkoposti.join(", ")))])]),i("label",[t._v("lisää sähköposti asiakkaalle (valinnainen)")]),i("b-input",{model:{value:t.add_sahkoposti,callback:function(e){t.add_sahkoposti=e},expression:"add_sahkoposti"}})],1):t._e(),t.sending?i("div",{staticClass:"alert alert-info"},[t._v("lähetetään...")]):t._e()],1)],1):i("div",{staticClass:"alert alert-info"},[t._v("lataan...")]),!t.ready||"arkistoitu"!=t.request.status&&"peruttu"!=t.request.status?t._e():i("img",{staticStyle:{position:"absolute",top:"120px",left:"0%"},attrs:{src:a("f931")}})])},n=[],r=a("3835"),s=a("b85c"),o=a("2909"),l=a("1da1"),u=(a("96cf"),a("4d90"),a("d3b7"),a("25f0"),a("a15b9"),a("caad"),a("2532"),a("6062"),a("3ca3"),a("ddb0"),a("ac1f"),a("5319"),a("1276"),a("bc3a")),c=a.n(u),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-form-group",[a("label",[t._v("valitse kirjasto")]),a("b-select",{attrs:{id:"lib_select",options:t.libraries,"value-field":"_id","text-field":"nimi"},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}),t.current?a("b-container",[a("h3",[t._v(t._s(t.current.nimi))]),a("b-card",[a("table",t._l(t.fields,(function(e){return a("tr",{key:e.key},[a("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(e.key))]),"lomake"==e.key||"kotisivut"==e.key?a("td",[a("a",{attrs:{target:"_blank",href:t.current[e.key]}},[t._v(t._s(t.current[e.key]))])]):a("td",[a("b",[t._v(t._s(t.current[e.key]))])])])})),0)]),t.current.lomake?t._e():a("div",[a("label",[t._v("saatepohjat")]),a("b-select",{attrs:{id:"saate_select",options:t.saatteet,"value-field":"_id","text-field":"_id"},model:{value:t.message_id,callback:function(e){t.message_id=e},expression:"message_id"}}),a("label",[t._v("saateviesti")]),a("b-form-textarea",{attrs:{id:"textarea",placeholder:"valitse saatepohja...",rows:"10"},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}})],1),t.current.lomake&&""!=t.current.lomake?a("div",[a("div",{staticClass:"alert alert-info"},[a("a",{attrs:{target:"_blank",href:t.current.lomake}},[t._v("tilauslomake")]),t._v(" (aukeaa uuteen ikkunaan)")]),a("br")]):t._e(),a("b-button",{staticClass:"float-right",staticStyle:{"margin-top":"20px"},attrs:{id:"send-order",variant:"primary"},on:{click:function(e){return t.sendOrder()}}},[t._v("lähetä tilaus")]),t.sending?a("div",{staticClass:"alert alert-info"},[t._v("Lähetetään...")]):t._e(),a("b-form-checkbox",{attrs:{id:"checkbox-2",name:"checkbox-2",value:"no","unchecked-value":"yes"},model:{value:t.send_email,callback:function(e){t.send_email=e},expression:"send_email"}},[t._v(" älä lähetä tilausta sähköpostitse ")])],1):t._e()],1),t.error?a("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e()],1)},_=[],h=(a("e9c4"),{name:"WEOrderForm",data:function(){return{libraries:[],message:"",message_id:null,info:"",selected:null,current:null,error:null,fields:[{key:"email",label:"sähköposti"},{key:"osoite"},{key:"kotisivut"}],saatteet:[],send_email:"yes",sending:!1}},props:["request"],watch:{selected:function(){this.getCurrent()},message_id:function(){var t,e=Object(s["a"])(this.saatteet);try{for(e.s();!(t=e.n()).done;){var a=t.value;if(a._id==this.message_id){this.message=a.saate;var i=this.getInfo("en"),n=this.getInfo("fi");this.message=this.message.replace("[[ID]]",this.request._id),this.request.tarvitaan_viimeistaan&&"undefined"!=this.request.tarvitaan_viimeistaan&&(this.message=this.message.replace("[[TARVITAAN_VIIMEISTAAN]]",this.request.tarvitaan_viimeistaan)),this.message=this.message.replace("[[EN]]",i),this.message=this.message.replace("[[FI]]",n)}}}catch(r){e.e(r)}finally{e.f()}}},methods:{getCurrent:function(){var t,e=Object(s["a"])(this.libraries);try{for(e.s();!(t=e.n()).done;){var a=t.value;a._id==this.selected&&(this.current=a,this.message=a.saate)}}catch(i){e.e(i)}finally{e.f()}},getInfo:function(t){var e={pyynto_id:{en:"ID",fi:"ID"},teoksen_tiedot:{en:"title",fi:"teos"}};return e["teoksen_tiedot"][t]+": "+this.request.teoksen_tiedot},sendOrder:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.message){e.next=3;break}return alert("Saateviesti on pakollinen!"),e.abrupt("return");case 3:return t.sending=!0,a={kirjasto_id:t.current._id,kirjaston_nimi:t.current.nimi,viesti:t.message,info:t.info,message_id:t.message_id,send_mail:t.send_email},e.prev=5,e.next=8,fetch(t.$G.api_url+"/api/pyynnot/"+t.$route.params.id+"/tilaukset",{method:"POST",body:JSON.stringify(a)});case 8:return i=e.sent,e.next=11,i.json();case 11:if(n=e.sent,i.ok){e.next=16;break}throw"fail";case 16:t.sending=!1,t.$emit("exit",!0);case 18:e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](5),t.sending=!1,n&&n.error?alert(n.error):alert("virhe "+e.t0);case 24:case"end":return e.stop()}}),e,null,[[5,20]])})))()},loadMessages:function(){var t=this;fetch(this.$G.api_url+"/api/saatteet?_id=tilaussaate*").then((function(t){return t.json()})).then((function(e){t.saatteet=e,t.ready=!0})).catch((function(t){console.log("error"+t)}))},loadData:function(){var t=this;this.ready=!1,fetch(this.$G.api_url+"/api/kirjastot?sort=nimi").then((function(t){return t.json()})).then((function(e){t.libraries=e,t.loadMessages(),t.ready=!0})).catch((function(t){alert("error"+t)}))}},mounted:function(){this.loadData()}}),p=h,m=a("2877"),k=Object(m["a"])(p,d,_,!1,null,null,null),v=k.exports,f=a("5370"),y=a("96dd"),b={name:"WERequests",components:{WEOrderForm:v,DueDate:f["a"]},data:function(){return{request:null,client:null,client_query:"",title:"",join_client:null,add_sahkoposti:"",payer:null,payer_selected:null,payer_info:"",payer_is_client:"no",orders:[],clients_result:null,arrived_order:null,laheta_saapumisilmoitus:"yes",laheta_peruutusilmoitus:"yes",organisations:[],ready:!1,error:null,note:"",show:!1,sending:!1,show_modal_arrived:!1,show_modal_payer:!1,show_modal_loan_date:!1,show_modal_due_notice:!1,show_modal_external:!1,show_modal_note:!1,show_modal_title:!1,show_modal_cancel_request:!1,show_modal_cancel_archive:!1,show_modal_join_client:!1,cancel_reason:"",due_notice:"",new_loan_date:"",external_client:{},loan_library_name:"",primaryBG:"primary",primaryText:"white",tilaus_uusittavissa:"yes",tilaus_info:"",fields:[{key:"teoksen_tiedot"},{key:"tilaajan_nimi"},{key:"tilaajan_sahkoposti",label:"tilaajan sähköposti"},{key:"toiminto"}],order_fields:[{key:"kirjaston_nimi"},{key:"status",label:"status"},{key:"pvm",label:"tilaus tehty"},{key:"pvm_saapunut",label:"saapunut"},{key:"toiminto"}],client_fields:[{key:"sukunimi"},{key:"etunimi"},{key:"sahkoposti",label:"sähköposti"},{key:"valitse",label:"valitse"}]}},props:["status"],watch:{$route:function(t,e){this.$route.params.id?this.loadData():this.current=null}},methods:{openJoinClient:function(t){this.show_modal_join_client=!0,this.join_client=t},formatDate:function(t,e,a){a||(a=".");var i=[];if(t){var n=new Date(t);return n instanceof Date&&isFinite(n)?(i.push(n.getFullYear()),i.push((n.getMonth()+1).toString().padStart(2,"0")),i.push(n.getDate().toString().padStart(2,"0")),e?i.reverse().join(a):i.join(a)):t}return"-"},isExternal:function(){return!(!this.request.tilaajan_sahkoposti.includes("_external_")||this.request.tilaaja)},saveJoinClient:function(t){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var i,n,r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t&&t.preventDefault(),i={tilaaja:e.join_client._id},n={},r=e.$G.api_url+"/api/pyynnot/"+e.$route.params.id,s=e.$G.api_url+"/api/asiakkaat/"+e.join_client._id,a.prev=5,a.next=8,c.a.put(r,i);case 8:return a.sent,e.add_sahkoposti.includes("@")&&(e.join_client.sahkoposti.push(e.add_sahkoposti),n.sahkoposti=Object(o["a"])(new Set(e.join_client.sahkoposti))),a.next=12,c.a.put(s,n);case 12:a.sent,e.loadData(),e.show_modal_join_client=!1,a.next=20;break;case 17:a.prev=17,a.t0=a["catch"](5),alert("Asiakkaan liittäminen tai sähköpostin lisäys ei onnistunut! "+a.t0);case 20:case"end":return a.stop()}}),a,null,[[5,17]])})))()},saveExternalClient:function(t){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var i,n,r,s,o,l,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.preventDefault(),e.external_client.sahkoposti&&e.external_client.sahkoposti.includes("@")&&""!=e.external_client.sahkoposti){a.next=4;break}return alert("Sähköposti on pakollinen tieto"),a.abrupt("return");case 4:return i=e.$G.api_url+"/api/asiakkaat?sahkoposti="+e.external_client.sahkoposti,a.prev=5,a.next=8,c.a.get(i);case 8:return n=a.sent,r={tilaajan_sahkoposti:e.external_client.sahkoposti},s=e.$G.api_url+"/api/pyynnot/"+e.$route.params.id,a.next=13,c.a.put(s,r);case 13:return a.sent,a.next=16,n.data;case 16:if(o=a.sent,0!=o.length){a.next=31;break}return a.prev=18,l=e.$G.api_url+"/api/asiakkaat/",a.next=22,c.a.post(l,e.external_client);case 22:return u=a.sent,e.join_client=u.data,a.next=26,e.saveJoinClient();case 26:a.next=31;break;case 28:a.prev=28,a.t0=a["catch"](18),alert(a.t0);case 31:e.show_modal_external=!1,e.loadData(),a.next=39;break;case 35:a.prev=35,a.t1=a["catch"](5),alert(a.t1),console.log(a.t1);case 39:case"end":return a.stop()}}),a,null,[[5,35],[18,28]])})))()},cancelPayer:function(){"asiakas"==this.request.maksaja&&(this.payer_is_client="yes")},setPayer:function(t){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={maksaja_varmistettu:e.payer_selected,maksaja_info:e.payer_info,maksaja:"laitos"},"yes"==e.payer_is_client&&(a={maksaja_varmistettu:null,maksaja:"asiakas"}),t.prev=2,i=e.$G.api_url+"/api/pyynnot/"+e.$route.params.id,t.next=6,c.a.put(i,a);case 6:t.sent,e.loadData(),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](2),alert(t.t0);case 13:case"end":return t.stop()}}),t,null,[[2,10]])})))()},updateTitle:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y["a"].updateRequest(t.$route.params.id,{teoksen_tiedot:t.title});case 3:t.loadData(),e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),alert(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))()},setNonArchived:function(){var t=this,e=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id,a={status:"kasittelyssa"};c.a.put(e,a).then((function(e){t.loadData()})).catch((function(e){alert("Muutoksen tallettaminen epäonnistui "+t.getError(e,""))}))},openArrived:function(t){this.arrived_order=t,this.arrived_order.erapaiva=this.$G.getToday("reverse",1),this.show_modal_arrived=!0},openKarhuRequest:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c()(t.$G.api_url+"/api/saatteet?_id=asiakas: karhu");case 3:a=e.sent,t.due_notice=a.data[0].saate,t.due_notice=t.due_notice.replace("[[FI]]",t.$G.getInfo(t.request,"fi")),t.due_notice=t.due_notice.replace("[[EN]]",t.$G.getInfo(t.request,"en")),t.due_notice=t.due_notice.replace("[[ERAPAIVA]]",t.formatDate(t.request.tilaus_saatu.pvm_erapaiva,"reverse",".")),t.due_notice=t.due_notice.replace("[[ERAPAIVA]]",t.formatDate(t.request.tilaus_saatu.pvm_erapaiva,"reverse",".")),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),alert("karhuviestipohjaa ei saatu");case 14:t.show_modal_due_notice=!0;case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))()},openCancelRequest:function(){var t=this;c.a.get(this.$G.api_url+"/api/saatteet?_id=asiakas: peruutusviesti").then((function(e){t.cancel_reason=e.data[0].saate,t.cancel_reason=t.cancel_reason.replace("[[FI]]",t.$G.getInfo(t.request,"fi")),t.cancel_reason=t.cancel_reason.replace("[[EN]]",t.$G.getInfo(t.request,"en"))})).catch((function(e){t.cancel_reason="peruutusviestipohjaa ei löytynyt!"})),this.show_modal_cancel_request=!0},convertToBook:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a={teos_on:"kirja"},i=t.$G.api_url+"/api/pyynnot/"+t.$route.params.id,c.a.put(i,a).then((function(e){t.loadData()})).catch((function(e){alert("Muunnoksen tallettaminen epäonnistui "+t.getError(e,""))}));case 3:case"end":return e.stop()}}),e)})))()},setNote:function(t){var e=this;t.preventDefault(),this.sending=!0;var a={huomautuksia:this.note},i=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id;c.a.put(i,a).then((function(t){e.sending=!1,e.show_modal_note=!1,e.loadData()})).catch((function(t){alert("Huomion tallettaminen epäonnistui"),e.error=t,e.sending=!1}))},setDueDate:function(){""==this.new_loan_date&&(this.new_loan_date=this.formatDate(this.request.tilaus_saatu.pvm_erapaiva,"reverse","."))},sendDueNotice:function(t){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var i,n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.preventDefault(),e.sending=!0,i={notice:e.due_notice},n=e.$G.api_url+"/api/pyynnot/"+e.$route.params.id+"/karhu",a.prev=4,a.next=7,c.a.post(n,i);case 7:a.sent,e.sending=!1,e.show_modal_due_notice=!1,e.loadData(),a.next=19;break;case 13:a.prev=13,a.t0=a["catch"](4),e.sending=!1,r="",a.t0.response.data&&a.t0.response.data.error&&(r=a.t0.response.data.error),alert(r);case 19:case"end":return a.stop()}}),a,null,[[4,13]])})))()},setCancelled:function(){var t=this;this.sending=!0;var e={peruutuksen_syy:this.cancel_reason,laheta_peruutusilmoitus:this.laheta_peruutusilmoitus},a=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id+"/cancelled";c.a.put(a,e).then((function(e){t.sending=!1,t.loadData()})).catch((function(e){alert("peruutus epäonnistui"),t.sending=!1,t.error=e}))},setLoanDate:function(t){var e=this;this.sending=!0,t.preventDefault();var a={due_date:this.new_loan_date.split(".").reverse().join("-"),info:this.tilaus_info,uusittavissa:this.tilaus_uusittavissa},i=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id+"/due_date";c.a.put(i,a).then((function(t){e.sending=!1,e.show_modal_loan_date=!1,e.loadData()})).catch((function(t){e.sending=!1,alert(e.getError(t,"eräpäivän asettaminen epäonnistui"))}))},setReturned:function(){var t=this;this.sending=!0;var e={pvm_palautettu:this.$G.getToday(),status:"palautettu"},a=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id+"/returned";c.a.put(a,e).then((function(e){t.sending=!1,t.loadData()})).catch((function(e){t.sending=!1,alert(t.getError(e,"Arkistointi epäonnistui"))}))},setNotAvailable:function(t){var e=this;this.sending=!1;var a=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id+"/tilaukset/"+t+"/not_available";c.a.put(a,{}).then((function(t){e.sending=!1,e.loadData()})).catch((function(t){e.sending=!1,alert(e.getError(t,"Pyyntö epäonnistui"))}))},setArrived:function(t){var e=this;t.preventDefault(),this.sending=!1;var a={erapaiva:this.arrived_order.erapaiva.split(".").reverse().join("-"),maksu:this.arrived_order.maksu,laheta_saapumisilmoitus:this.laheta_saapumisilmoitus},i=this.$G.api_url+"/api/pyynnot/"+this.$route.params.id+"/tilaukset/"+this.arrived_order._id+"/arrived";c.a.put(i,a).then((function(t){e.sending=!1,e.show_modal_arrived=!1,e.loadData()})).catch((function(t){e.sending=!1,alert(e.getError(t,"Pyyntö epäonnistui"))}))},checkDate:function(t){var e=t.split(".");if(3!==e.length)return!1},reserve:function(t){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var i,n,r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=e.$G.api_url+"/api/pyynnot/"+t,a.next=3,c.a.get(i);case 3:if(n=a.sent,r=n.data,!r||""!=r["status"]&&"uusi"!=r["status"]){a.next=10;break}return s={status:"kasittelyssa",kasittelija:e.$G.user},a.next=9,c.a.put(i,s);case 9:a.sent;case 10:case"end":return a.stop()}}),a)})))()},setLoanLibrary:function(){var t,e=Object(s["a"])(this.orders);try{for(e.s();!(t=e.n()).done;){var a=t.value;a.pvm_saapunut&&(this.loan_library_name=a.kirjaston_nimi)}}catch(i){e.e(i)}finally{e.f()}},searchClients:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.$G.api_url+"/api",e.next=3,c.a.get(a+"/asiakkaat/?search="+t.client_query);case 3:i=e.sent,t.clients_result=i.data;case 5:case"end":return e.stop()}}),e)})))()},loadData:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a,i,n,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.show=!1,t.error=null,t.arrived_order=null,t.ready=!1,t.payer_selected=null,t.payer_is_client="no",e.prev=6,a=t.$G.api_url+"/api",e.next=10,Promise.all([c.a.get(a+"/pyynnot/"+t.$route.params.id),c.a.get(a+"/organisaatiot")]);case 10:i=e.sent,n=Object(r["a"])(i,2),s=n[0],o=n[1],t.request=s.data,t.request.tilaus_saatu&&(t.tilaus_uusittavissa=t.request.tilaus_saatu.uusittavissa,t.tilaus_info=t.request.tilaus_saatu.info),t.request.tilaajan_sahkoposti||(t.request.tilaajan_sahkoposti="VIRHEELLINEN TILAAJA"),t.title=t.request.teoksen_tiedot,t.orders=t.request.tilaukset,t.note=t.request.huomautuksia,t.organisations=o.data,t.request.maksaja_varmistettu&&t.request.maksaja_varmistettu._id&&(t.payer_selected=t.request.maksaja_varmistettu._id),"asiakas"===t.request.maksaja&&(t.payer_is_client="yes"),t.setLoanLibrary(),t.request.tilaajan_sahkoposti.includes("_external_")&&(t.external_client.sukunimi=t.request.sukunimi,t.external_client.etunimi=t.request.etunimi,t.external_client.kirjastokortin_numero=t.request.kirjastokortin_numero,t.client_query=t.request.sukunimi,t.searchClients()),t.ready=!0,"uusi"===t.request.status&&t.reserve(t.request._id),e.next=34;break;case 29:e.prev=29,e.t0=e["catch"](6),alert(e.t0),t.error="virhe",t.ready=!0;case 34:case"end":return e.stop()}}),e,null,[[6,29]])})))()},getError:function(t,e){return t.response&&t.response.data&&t.response.data.error?t.response.data.error:e}},mounted:function(){this.loadData()}},g=b,j=(a("c678"),Object(m["a"])(g,i,n,!1,null,"73c88aa6",null));e["a"]=j.exports},e347:function(t,e,a){t.exports=a.p+"img/logo.cf45db45.svg"},f392:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",{attrs:{fluid:""}},[a("h1",[t._v("Asiakkaat")]),t.ready?t._e():a("div",{staticClass:"alert alert-info"},[t._v("lataan...")]),t.current_client?t._e():a("b-card",{attrs:{title:"haku"}},[a("b-row",{staticClass:"my-1"},[a("b-col",{attrs:{sm:"4"}},[a("b-form-input",{attrs:{id:"input-default",placeholder:"hae sukunimellä tai sähköpostilla"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.search_term,callback:function(e){t.search_term=e},expression:"search_term"}}),a("b-button",{on:{click:t.search}},[t._v("hae")])],1)],1)],1),0===t.search_result.length||t.current_client?t._e():a("div",[a("b-table",{attrs:{items:t.search_result,fields:t.fields},scopedSlots:t._u([{key:"cell(sahkoposti)",fn:function(e){return[a("b",{staticClass:"text-info"},[t._v(t._s(e.value.join(", ")))])]}},{key:"cell(sukunimi)",fn:function(e){return[a("b-link",{attrs:{to:"/asiakkaat/"+e.item._id}},[t._v(t._s(e.value))])]}}],null,!1,1301209900)})],1),t.current_client?a("div",[t.edit?t._e():a("b-card",{attrs:{title:t.current_client.sukunimi+", "+t.current_client.etunimi,"header-bg-variant":"dark"}},[a("table",t._l(t.fields,(function(e){return a("tr",{key:e.key},[a("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(e.label))]),"sahkoposti"==e.key?a("td",{staticStyle:{"min-width":"350px"}},t._l(t.current_client.sahkoposti,(function(e){return a("div",{key:e},[a("a",{attrs:{href:"mailto:"+e}},[t._v(t._s(e))])])})),0):a("td",[a("b",[t._v(t._s(t.current_client[e.key]))])])])})),0),t.edit?t._e():a("b-icon",{staticClass:"float-right pointer",attrs:{icon:"pen",variant:"primary"},on:{click:function(e){t.edit=!t.edit}}},[t._v("muokkaa")])],1),t.edit?a("b-card",{attrs:{title:t.current_client.sukunimi,"header-bg-variant":"dark"}},[a("table",{staticClass:"table table-striped"},t._l(t.fields,(function(e){return a("tr",{key:e.key},[a("td",{staticStyle:{"min-width":"200px"}},[t._v(t._s(e.label))]),"sahkoposti"==e.key?a("td",{staticStyle:{"min-width":"350px"}},[t.current_client[e.key]&&t.current_client[e.key][0]?a("b-form-input",{model:{value:t.current_client[e.key][0],callback:function(a){t.$set(t.current_client[e.key],0,a)},expression:"current_client[field.key][0]"}}):t._e(),t.current_client[e.key]?a("b-form-input",{model:{value:t.current_client[e.key][1],callback:function(a){t.$set(t.current_client[e.key],1,a)},expression:"current_client[field.key][1]"}}):t._e()],1):"ulkopuolinen"==e.key?a("td",[a("b-form-checkbox",{attrs:{id:"checkbox-1",name:"checkbox-1"},model:{value:t.current_client.ulkopuolinen,callback:function(e){t.$set(t.current_client,"ulkopuolinen",e)},expression:"current_client.ulkopuolinen"}})],1):a("td",{staticStyle:{"min-width":"350px"}},[a("b-form-input",{model:{value:t.current_client[e.key],callback:function(a){t.$set(t.current_client,e.key,a)},expression:"current_client[field.key]"}})],1)])})),0),a("b-container",[a("b-button",{staticClass:"float-right",staticStyle:{"margin-left":"20px"},attrs:{variant:"primary"},on:{click:function(e){return t.saveForm()}}},[t._v("tallenna")]),a("b-button",{staticClass:"float-right",on:{click:function(e){t.edit=!t.edit}}},[t._v("peru")])],1)],1):t._e(),a("b-link",{attrs:{to:"/asiakkaat"}},[t._v("takaisin hakuun")]),a("h2",{staticStyle:{"margin-top":"40px"}},[t._v(t._s(t.laina_title))]),a("b-form-checkbox",{attrs:{id:"checkbox-1",name:"show-all-requests"},model:{value:t.show_all_requests,callback:function(e){t.show_all_requests=e},expression:"show_all_requests"}},[t._v(" näytä kaikki pyynnöt ")]),a("b-table",{attrs:{items:t.requests,fields:t.request_fields},scopedSlots:t._u([{key:"cell(tiedot)",fn:function(e){return[a("div",{staticStyle:{"min-width":"250px"}},[a("b-link",{attrs:{to:"/pyynnot/"+e.item._id}},[t._v(t._s(e.item.teoksen_tiedot))])],1)]}},{key:"cell(kirjasto)",fn:function(e){return[e.item.tilaus_saatu?a("b-link",{attrs:{to:"/kirjastot/"+e.item.tilaus_saatu.kirjasto_id}},[t._v(t._s(e.item.tilaus_saatu.kirjaston_nimi))]):t._e()]}},{key:"cell(tilaus_saatu.pvm_erapaiva)",fn:function(t){return[a("DueDate",{attrs:{item:t.item}})]}},{key:"cell(_id)",fn:function(e){return[t._v(" "+t._s(e.value)+" ")]}}],null,!1,2355413550)})],1):t._e()],1)},n=[],r=a("1da1"),s=a("b85c"),o=(a("96cf"),a("caad"),a("2532"),a("ac1f"),a("5319"),a("4de4"),a("d3b7"),a("e9c4"),a("5370")),l={name:"WEClient",components:{DueDate:o["a"]},data:function(){return{search_term:"",search_result:[],requests:[],all_requests:[],show_all_requests:!1,current_client:null,ready:!0,edit:!1,laina_title:"lainassa olevat kaukolainat",laina_button_title:"näytä kaikki kaukolainapyynnöt",fields:[{key:"sukunimi",label:"sukunimi"},{key:"etunimi",label:"etunimi"},{key:"sahkoposti",label:"sähköposti"},{key:"kirjastokortin_numero",label:"kirjastokortti"},{key:"puhelin",label:"puhelin"},{key:"osoite",label:"osoite"},{key:"huomio",label:"lisätieto"},{key:"ulkopuolinen",label:"ulkopuolinen asiakas"}],request_fields:[{key:"_id",label:"tunniste"},{key:"teos_on",label:"tyyppi"},{key:"tiedot"},{key:"kirjasto",label:"kirjasto"},{key:"maksu",label:"maksu"},{key:"maksaja",label:"maksaja"},{key:"status"},{key:"tilaus_saatu.pvm_erapaiva",label:"eräpäivä"}]}},watch:{show_all_requests:function(){this.showAllRequests()},$route:function(t,e){t.path.includes("/asiakkaat")&&(this.$route.params.id?this.loadData():e.path.includes("/asiakkaat")?this.current_client=null:this.current_client&&this.$router.replace({path:"/asiakkaat/"+this.current_client._id}))}},methods:{saveForm:function(){var t=this;delete this.current_client._id,this.current_client.sahkoposti=this.current_client.sahkoposti.filter((function(t){return""!=t})),fetch(this.$G.api_url+"/api/asiakkaat/"+this.$route.params.id,{method:"PUT",body:JSON.stringify(this.current_client)}).then((function(t){return t.json()})).then((function(e){t.loadData()})).catch((function(t){alert("Talletus ei onnistunut"+t),console.log("error"+t)}))},loadData:function(){var t=this;this.$route.params.id&&(this.ready=!1,this.edit=!1,this.current_client=null,fetch(this.$G.api_url+"/api/asiakkaat/"+this.$route.params.id).then((function(t){return t.json()})).then((function(e){t.current_client=e,t.loadRelated()})).catch((function(t){console.log("error"+t)})))},showAllRequests:function(){this.show_all_requests?(this.requests=this.all_requests,this.laina_title="kaikki kaukolainapyynnöt",this.laina_button_title="näytä vain lainassa olevat"):(this.requests=this.sortByStatus(this.all_requests),this.laina_title="lainassa olevat kaukolainat",this.laina_button_title="näytä kaikki kaukalainapyynnöt")},sortByStatus:function(t){var e,a=[],i=Object(s["a"])(t);try{for(i.s();!(e=i.n()).done;){var n=e.value;"lainassa"===n.status&&a.push(n)}}catch(r){i.e(r)}finally{i.f()}return a},loadRelated:function(){var t=this;fetch(this.$G.api_url+"/api/pyynnot/?sort=tilaus_saatu.pvm_erapaiva&reverse=1&tilaaja="+this.current_client._id).then((function(t){return t.json()})).then((function(e){t.all_requests=e,t.requests=t.sortByStatus(e),t.ready=!0})).catch((function(t){console.log("error"+t)}))},search:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.current_client=null,""===t.search_term){e.next=9;break}return a="search="+t.search_term,e.next=5,fetch(t.$G.api_url+"/api/asiakkaat?"+a);case 5:return i=e.sent,e.next=8,i.json();case 8:t.search_result=e.sent;case 9:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.loadData()}},u=l,c=a("2877"),d=Object(c["a"])(u,i,n,!1,null,null,null);e["a"]=d.exports},f931:function(t,e,a){t.exports=a.p+"img/arkistoitu_vino.c22fb25a.png"}});
//# sourceMappingURL=app.186bd8e5.js.map